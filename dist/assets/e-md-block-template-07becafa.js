import{e as q}from"./emdV2Store-a3b70642.js";import{d as A,bg as oe,b as r,z as M,S as $,m as re,a as w,c as z,i as v,ay as ne,g as i,w as u,t as ie,n as E,f as x,aA as de,k as N,U as ue,V as ce,as as fe,bh as ve,q as P,F as me,s as o,x as pe,au as _e,$ as be,a0 as ge,ad as Ce,a8 as xe,aE as ke,_ as F,bi as ye}from"./index-8f9ccc2f.js";import{G as he}from"./getAllCourse-e5fc59da.js";import{G as we,U as Ie,a as Ve,b as Pe,c as De,d as Ue,C as $e,e as Ee,f as Be,D as Le,g as Re}from"./delLabProc-07e2f500.js";const Se={class:"aside"},Ne={class:"emd-aside-tree-container"},qe={style:{width:"100%","max-width":"100%",display:"flex","flex-direction":"row","justify-content":"space-between"}},Ae={style:{width:"200px",overflow:"hidden"}},Me=["title"],ze={style:{flex:"0 0 80px",display:"flex","flex-direction":"row","justify-content":"end"}},Fe={class:"emd-aside-bottom"},Qe={class:"dialog-footer"},Te={class:"dialog-footer"},Ge=A({__name:"aside",setup(Q){const D=oe();r("main");const k=q(),m=r();M(m,(a,e)=>{a&&k.setTreeRef(a)});const p=r([]),B=()=>{he().then(a=>{a.state==200?p.value=a.data:o.error(a.message)})},U=r(),L=r(),T={label:(a,e)=>a.name,isLeaf:(a,e)=>e.level<5?!a.hasChildren:!0,class:(a,e)=>{switch(e.level){case 0:return"tree-l0";case 1:return"tree-l1";case 2:return"tree-l2";case 3:return"tree-l3"}}},G=(a,e)=>{a.level===1&&we(a.data.id).then(l=>{l.state==200?e(l.data):o.error(l.message)}),e([])},K=(a,e)=>{U.value=e,L.value=a,k.setCurrentNode(e),e.level==2&&D.push({name:"labQuestionBank",params:{labId:a.id}})},j=(a,e,l,n)=>{if(a.level!==e.level){o.error("节点只能在同级中拖拽排序");return}const C=e.parent,c=C?C.childNodes:p.value,y=c.findIndex(t=>t.data.id===a.data.id),h=c.findIndex(t=>t.data.id===e.data.id),[s]=c.splice(y,1);let g=h;l==="after"?g+=1:l==="before"&&y<h&&(g-=1),c.splice(g,0,s),c.forEach((t,se)=>{t.data.sort=se+1}),a.level===2&&Ie(c.map(t=>t.data)).then(t=>{t.state!==200&&o.error(t.message)}),a.level===3&&Ve(c.map(t=>t.data)).then(t=>{t.state!==200&&o.error(t.message)}),a.level===4&&Pe(c.map(t=>t.data)).then(t=>{t.state!==200&&o.error(t.message)}),a.level===5&&De(c.map(t=>t.data)).then(t=>{t.state!==200&&o.error(t.message)})},Y=a=>a.level,H=(a,e,l)=>l==="inner"?!1:a.parent===e.parent,_=r(!1),b=r(!1);r(!1);const R=r(),I=r(!1),f=r({id:null,name:""}),J=$({name:[{required:!0,message:"请输入课程名称",trigger:"blur"}]}),O=()=>{f.value.id=null,f.value.name="",I.value=!1},W=async a=>{a&&await a.validate((e,l)=>{e?I.value?Ue(f.value).then(n=>{n.state==200?(p.value=n.data,o.success("编辑成功"),_.value=!1):o.error(n.message)}):$e(f.value).then(n=>{n.state==200?(p.value=n.data,o.success("添加成功"),_.value=!1):o.error(n.message)}):o.info("请检查输入内容")})},S=r(),V=r(!1),d=r({id:null,courseId:null,name:"",sectionPrefix:""}),X=$({name:[{required:!0,message:"请输入实验名称",trigger:"blur"}],sectionPrefix:[{required:!0,message:"请输入AI知识库实验章节",trigger:"blur"}]}),Z=()=>{d.value.courseId=null,d.value.name="",d.value.sectionPrefix="",V.value=!1},ee=async a=>{a&&await a.validate((e,l)=>{e?V.value?Ee(d.value).then(n=>{n.state==200?(o.success("更新成功"),b.value=!1,m.value.updateKeyChildren(U.value.parent.data.treeId,n.data)):o.error(n.message)}):Be(d.value).then(n=>{n.state==200?(o.success("添加成功"),b.value=!1,U.value.data.hasChildren||B(),m.value.updateKeyChildren(L.value.treeId,n.data)):o.error(n.message)}):o.info("请检查输入内容")})};r({id:null,labModelId:null}),r(),r(!1),r({id:null,labProcId:null,name:"",icon:"",isNeedAiAsk:!1,askNum:1,sectionPrefix:"",stage:"before-class"}),$({name:[{required:!0,message:"请输入模块名称",trigger:"blur"}],askNum:[{required:!0,message:"请设置问题个数",trigger:"blur"}],sectionPrefix:[{required:!0,message:"请输入ai知识库章节序号",trigger:"blur"}],stage:[{required:!0,message:"请选择课前部分还是课后部分",trigger:"blur"}]});const ae=(a,e)=>{switch(e.level){case 1:d.value.courseId=e.data.id,b.value=!0;break}},te=(a,e)=>{switch(e.level){case 1:f.value.id=e.data.id,f.value.name=e.data.name,I.value=!0,_.value=!0;break;case 2:d.value.id=e.data.id,d.value.name=e.data.name,d.value.sectionPrefix=e.data.sectionPrefix,V.value=!0,b.value=!0;break}},le=(a,e)=>{switch(e.level){case 1:if(e.data.hasChildren){o.error("请先删除课程中的内容");return}f.value.id=e.data.id,Re(f.value).then(l=>{l.state==200?(p.value=l.data,o.success("删除成功"),f.value.id=null):o.error(l.message)});break;case 2:if(e.data.hasChildren){o.error("请先删除实验中的内容");return}d.value.id=e.data.id,Le(d.value).then(l=>{l.state==200?(o.success("删除成功"),m.value.remove(e),d.value.id=null):o.error(l.message)});break}};return re(()=>{B()}),(a,e)=>{const l=pe,n=_e,C=be,c=ge,y=Ce,h=xe;return w(),z(me,null,[v("div",Se,[e[10]||(e[10]=ne('<div class="emd-aside-top" data-v-04f811f8><div class="sidebar-top" data-v-04f811f8><a href="/" data-v-04f811f8><div style="height:60px;padding:5px;" data-v-04f811f8><img src="'+ke+'" alt="" data-v-04f811f8></div></a></div></div>',1)),v("div",Ne,[i(x(ve),{ref_key:"treeRef",ref:m,class:"emd-aside-tree",data:p.value,props:T,lazy:"",accordion:"",load:G,onNodeClick:K,draggable:"","allow-drag":Y,"allow-drop":H,onNodeDrop:j,"expand-on-click-node":!1,"node-key":"treeId"},{default:u(({node:s,data:g})=>[v("div",qe,[v("div",Ae,[v("span",{title:s.label,style:{overflow:"hidden"}},ie(s.label),9,Me)]),v("div",ze,[s.level<2?(w(),E(l,{key:0,type:"primary",size:"small",link:"",icon:x(de),onClick:t=>ae(g,s)},null,8,["icon","onClick"])):N("",!0),s.level<3?(w(),E(l,{key:1,type:"info",size:"small",link:"",icon:x(ue),onClick:t=>te(g,s)},null,8,["icon","onClick"])):N("",!0),i(n,{"confirm-button-text":"Yes","cancel-button-text":"No",icon:x(ce),"icon-color":"#626AEF",title:"确定删除该内容?",onConfirm:t=>le(g,s)},{reference:u(()=>[i(l,{type:"danger",size:"small",link:"",icon:x(fe)},null,8,["icon"])]),_:2},1032,["icon","onConfirm"])])])]),_:1},8,["data"])]),v("div",Fe,[v("div",{class:"floating-button",onClick:e[0]||(e[0]=s=>_.value=!0)}," + ")])]),i(h,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),title:I.value?"编辑课程名称":"添加课程",width:"30%",onClose:O},{footer:u(()=>[v("div",Qe,[i(l,{onClick:e[2]||(e[2]=s=>_.value=!1)},{default:u(()=>e[11]||(e[11]=[P("取消",-1)])),_:1,__:[11]}),i(l,{type:"primary",onClick:e[3]||(e[3]=s=>W(R.value))},{default:u(()=>e[12]||(e[12]=[P(" 提交 ",-1)])),_:1,__:[12]})])]),default:u(()=>[i(y,{ref_key:"addCourseRef",ref:R,model:f.value,rules:J,"label-width":"80px"},{default:u(()=>[i(c,{label:"课程名称",prop:"name"},{default:u(()=>[i(C,{modelValue:f.value.name,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value.name=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),i(h,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=s=>b.value=s),title:V.value?"编辑实验名称":"添加实验",width:"30%",onClose:Z},{footer:u(()=>[v("div",Te,[i(l,{onClick:e[7]||(e[7]=s=>b.value=!1)},{default:u(()=>e[13]||(e[13]=[P("取消",-1)])),_:1,__:[13]}),i(l,{type:"primary",onClick:e[8]||(e[8]=s=>ee(S.value))},{default:u(()=>e[14]||(e[14]=[P(" 提交 ",-1)])),_:1,__:[14]})])]),default:u(()=>[i(y,{ref_key:"addLabRef",ref:S,model:d.value,rules:X,"label-width":"100px"},{default:u(()=>[i(c,{label:"实验名称",prop:"name"},{default:u(()=>[i(C,{modelValue:d.value.name,"onUpdate:modelValue":e[5]||(e[5]=s=>d.value.name=s)},null,8,["modelValue"])]),_:1}),i(c,{label:"知识库章节",prop:"sectionPrefix"},{default:u(()=>[i(C,{modelValue:d.value.sectionPrefix,"onUpdate:modelValue":e[6]||(e[6]=s=>d.value.sectionPrefix=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}});const Ke=F(Ge,[["__scopeId","data-v-04f811f8"]]),je={class:"emdContainer"},Ye={class:"emd-catalogue-container"},He={class:"emd-content-container"},Je=A({__name:"e-md-block-template",setup(Q){const D=q(),k=r("main");return M(()=>D.routerKey,m=>{k.value=m}),(m,p)=>(w(),z("div",je,[v("div",Ye,[i(Ke)]),v("div",He,[(w(),E(x(ye),{key:k.value}))])]))}});const ea=F(Je,[["__scopeId","data-v-2533b24e"]]);export{ea as default};
