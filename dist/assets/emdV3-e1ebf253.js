import{e as ae}from"./emdV2Store-a3b70642.js";import{h as I,d as le,bg as Ve,b as n,z as j,S as z,m as he,e as we,a as V,c as B,i as _,ay as Ie,g as l,w as o,t as O,k as w,f as x,n as U,aA as Pe,U as Ee,V as Le,as as Ne,bh as Ae,q as c,F as Me,s as r,x as De,au as Ue,aF as Se,aI as Re,ap as Be,$ as $e,a0 as Te,ad as Ge,a8 as qe,a2 as Ke,a3 as Qe,a7 as Fe,aE as ze,_ as te,bi as Oe}from"./index-8f9ccc2f.js";/* empty css                     */import{G as je}from"./getAllCourse-e5fc59da.js";import{G as He,U as Xe,a as Ye,b as Je,c as We,d as Ze,C as ea,e as aa,f as la,D as ta,g as sa}from"./delLabProc-07e2f500.js";import{G as oa,a as ra}from"./getBlockBySection-6c35c21c.js";import{B as R}from"./block-d7a047ff.js";import"./marked.esm-fed877e7.js";function ee(m){return I({url:"elaborate/md/lab_model/"+m,method:"GET"})}function ia(m){return I({url:"elaborate/md/compose/"+m,method:"GET"})}function da(m){return I({url:"/elaborate/md/lab_model/create",method:"POST",data:m})}function ua(m){return I({url:"/elaborate/md/lab_model/up",method:"POST",data:m})}function na(m){return I({url:"/elaborate/md/lab_model/del",method:"DELETE",data:m})}function fa(m){return I({url:"elaborate/md/block/del",method:"DELETE",data:m})}function ma(m){return I({url:"/elaborate/md/section/create",method:"POST",data:m})}function va(m){return I({url:"/elaborate/md/section/del",method:"DELETE",data:m})}const ca={class:"aside"},pa={class:"emd-aside-tree-container"},_a={style:{width:"100%","max-width":"100%",display:"flex","flex-direction":"row","justify-content":"space-between"}},ba={key:0,style:{width:"200px",overflow:"hidden"}},ga=["title"],ka={key:1,style:{width:"180px",overflow:"hidden"}},Ca=["title"],ya={key:2,style:{flex:"0 0 80px",display:"flex","flex-direction":"row","justify-content":"end"}},xa={class:"emd-aside-bottom"},Va={class:"mode-button"},ha={class:"dialog-footer"},wa={class:"dialog-footer"},Ia={class:"dialog-footer"},Pa=le({__name:"aside",setup(m){const D=Ve();n("main");const f=ae(),p=n();j(p,(a,e)=>{a&&f.setTreeRef(a)});const P=n([]),H=()=>{je().then(a=>{a.state==200?P.value=a.data:r.error(a.message)})},E=n(),K=n(),se={label:(a,e)=>{if(e.level>3)switch(a.name){case R.TEXT:return a.sort+"- 文本块";case R.QA:return a.sort+"- 问答题";case R.CHOICE:return a.sort+"- 选择题";case R.TABLE:return a.sort+"- 表格";case R.TRACELINE:return a.sort+"- 表格绘图";default:return a.name+"-"+a.sort}return a.name},isLeaf:(a,e)=>e.level<5?!a.hasChildren:!0,class:(a,e)=>{switch(e.level){case 0:return"tree-l0";case 1:return"tree-l1";case 2:return"tree-l2";case 3:return"tree-l3"}}},oe=(a,e)=>{a.level===1&&He(a.data.id).then(t=>{t.state==200?e(t.data):r.error(t.message)}),a.level===2&&ee(a.data.id).then(t=>{t.state==200?e(t.data):r.error(t.message)}),a.level===3&&oa(a.data.id).then(t=>{t.state==200?e(t.data):r.error(t.message)}),a.level===4&&ra(a.data.id).then(t=>{t.state==200?e(t.data):r.error(t.message)}),a.level===5&&ia(a.data.id).then(t=>{t.state==200?e(t.data):r.error(t.message)}),e([])},re=(a,e)=>{switch(E.value=e,K.value=a,f.setCurrentNode(e),e.level==2&&f.setCurrentLab(a.id),f.currentMode){case"阅读":e.level==2&&(f.setRouterKey("labProc-read-"+E.value.data.treeId),D.push({name:"emdV3LabRead",query:{labId:a.id}}));break;case"编辑":switch(e.level){case 4:f.setRouterKey("section-edit-"+E.value.data.treeId),f.setRouterSectionNode(e),D.push({name:"emdV3SectionEdit",query:{section:a.id}});break;default:D.push({name:"emdv3"});break}return;default:return}};j(()=>f.currentMode,a=>{D.push({name:"emdv3"})});const ie=(a,e,t,d)=>{if(a.level!==e.level){r.error("节点只能在同级中拖拽排序");return}const S=e.parent,C=S?S.childNodes:P.value,q=C.findIndex(u=>u.data.id===a.data.id),h=C.findIndex(u=>u.data.id===e.data.id),[y]=C.splice(q,1);let M=h;t==="after"?M+=1:t==="before"&&q<h&&(M-=1),C.splice(M,0,y),C.forEach((u,k)=>{u.data.sort=k+1}),a.level===2&&Xe(C.map(u=>u.data)).then(u=>{u.state!==200&&r.error(u.message)}),a.level===3&&Ye(C.map(u=>u.data)).then(u=>{u.state!==200&&r.error(u.message)}),a.level===4&&Je(C.map(u=>u.data)).then(u=>{u.state!==200&&r.error(u.message)}),a.level===5&&We(C.map(u=>u.data)).then(u=>{u.state!==200&&r.error(u.message)})},de=a=>a.level>1&&f.getCurrentMode=="编辑",ue=(a,e,t)=>t==="inner"?!1:a.parent===e.parent,L=n(!1),N=n(!1),A=n(!1),X=n(),$=n(!1),g=n({id:null,name:""}),ne=z({name:[{required:!0,message:"请输入课程名称",trigger:"blur"}]}),fe=()=>{g.value.id=null,g.value.name="",$.value=!1},me=async a=>{a&&await a.validate((e,t)=>{e?$.value?Ze(g.value).then(d=>{d.state==200?(P.value=d.data,r.success("编辑成功"),L.value=!1):r.error(d.message)}):ea(g.value).then(d=>{d.state==200?(P.value=d.data,r.success("添加成功"),L.value=!1):r.error(d.message)}):r.info("请检查输入内容")})},Y=n(),T=n(!1),v=n({id:null,courseId:null,name:"",sectionPrefix:""}),ve=z({name:[{required:!0,message:"请输入实验名称",trigger:"blur"}],sectionPrefix:[{required:!0,message:"请输入AI知识库实验章节",trigger:"blur"}]}),ce=()=>{v.value.courseId=null,v.value.name="",v.value.sectionPrefix="",T.value=!1},pe=async a=>{a&&await a.validate((e,t)=>{e?T.value?aa(v.value).then(d=>{d.state==200?(r.success("更新成功"),N.value=!1,p.value.updateKeyChildren(E.value.parent.data.treeId,d.data)):r.error(d.message)}):la(v.value).then(d=>{d.state==200?(r.success("添加成功"),N.value=!1,E.value.data.hasChildren||H(),p.value.updateKeyChildren(K.value.treeId,d.data)):r.error(d.message)}):r.info("请检查输入内容")})},J=n({id:null,labModelId:null}),W=n(),G=n(!1),i=n({id:null,labProcId:null,name:"",icon:"",isNeedAiAsk:!1,askNum:1,sectionPrefix:"",stage:"before-class"}),_e=z({name:[{required:!0,message:"请输入模块名称",trigger:"blur"}],askNum:[{required:!0,message:"请设置问题个数",trigger:"blur"}],sectionPrefix:[{required:!0,message:"请输入ai知识库章节序号",trigger:"blur"}],stage:[{required:!0,message:"请选择课前部分还是课后部分",trigger:"blur"}]}),be=()=>{i.value.id=null,i.value.labProcId=null,i.value.name="",i.value.icon="",i.value.isNeedAiAsk=!1,i.value.askNum=0,i.value.sectionPrefix="",i.value.stage="",G.value=!1},ge=async a=>{a&&await a.validate((e,t)=>{e?G.value?ua(i.value).then(d=>{d.state==200?(r.success("更新成功"),A.value=!1,p.value.updateKeyChildren(E.value.parent.data.treeId,d.data)):r.error(d.message)}):da(i.value).then(d=>{d.state==200?(r.success("添加成功"),A.value=!1,p.value.updateKeyChildren(K.value.treeId,d.data)):r.error(d.message)}):r.info("请检查输入内容")})},ke=(a,e)=>{switch(e.level){case 1:v.value.courseId=e.data.id,N.value=!0;break;case 2:i.value.labProcId=e.data.id,i.value.icon="fa-solid fa-circle-info",i.value.sectionPrefix=e.data.sectionPrefix,A.value=!0;break;case 3:J.value.labModelId=e.data.id,ma(J.value).then(t=>{t.state==200?(r.success("添加成功"),E.value.data.hasChildren||ee(e.data.parentId).then(d=>{d.state==200?p.value.updateKeyChildren(e.parent.data.treeId,d.data):r.error(t.message)}),p.value.updateKeyChildren(e.data.treeId,t.data)):r.error(t.message)});break}},Ce=(a,e)=>{switch(e.level){case 1:g.value.id=e.data.id,g.value.name=e.data.name,$.value=!0,L.value=!0;break;case 2:v.value.id=e.data.id,v.value.name=e.data.name,v.value.sectionPrefix=e.data.sectionPrefix,T.value=!0,N.value=!0;break;case 3:i.value.id=e.data.id,i.value.name=e.data.name,i.value.icon=e.data.icon,i.value.isNeedAiAsk=e.data.isNeedAiAsk,i.value.askNum=e.data.askNum,i.value.sectionPrefix=e.data.sectionPrefix,i.value.stage=e.data.stage,G.value=!0,A.value=!0;break}},ye=(a,e)=>{switch(e.level){case 1:if(e.data.hasChildren){r.error("请先删除课程中的内容");return}g.value.id=e.data.id,sa(g.value).then(t=>{t.state==200?(P.value=t.data,r.success("删除成功"),g.value.id=null):r.error(t.message)});break;case 2:if(e.data.hasChildren){r.error("请先删除实验中的内容");return}v.value.id=e.data.id,ta(v.value).then(t=>{t.state==200?(r.success("删除成功"),p.value.remove(e),v.value.id=null):r.error(t.message)});break;case 3:if(e.data.hasChildren){r.error("请先删除模块中的内容");return}i.value.id=e.data.id,na(i.value).then(t=>{t.state==200?(r.success("删除成功"),p.value.remove(e),i.value.id=null):r.error(t.message)});break;case 4:if(e.data.hasChildren){r.error("请先步骤中的内容");return}va(e.data).then(t=>{t.state==200?(r.success("删除成功"),p.value.remove(e)):r.error(t.message)});break;case 5:fa(e.data).then(t=>{t.state==200?(r.success("删除成功"),p.value.remove(e),f.setNeedUpdatePage(!0)):r.error(t.message)});break}};return he(()=>{H()}),(a,e)=>{const t=De,d=Ue,S=Se,C=Re,q=Be,h=$e,y=Te,M=Ge,u=qe,k=we("font-awesome-icon"),b=Ke,Q=Qe,xe=Fe;return V(),B(Me,null,[_("div",ca,[e[23]||(e[23]=Ie('<div class="emd-aside-top" data-v-3dcd17c9><div class="sidebar-top" data-v-3dcd17c9><a href="/" data-v-3dcd17c9><div style="height:60px;padding:5px;" data-v-3dcd17c9><img src="'+ze+'" alt="" data-v-3dcd17c9></div></a></div></div>',1)),_("div",pa,[l(x(Ae),{ref_key:"treeRef",ref:p,class:"emd-aside-tree",data:P.value,props:se,lazy:"",accordion:"",load:oe,onNodeClick:re,draggable:"","allow-drag":de,"allow-drop":ue,onNodeDrop:ie,"node-key":"treeId","highlight-current":""},{default:o(({node:s,data:F})=>[_("div",_a,[s.level<4?(V(),B("div",ba,[_("span",{title:s.label,style:{overflow:"hidden"}},O(s.label),9,ga)])):w("",!0),s.level>=4?(V(),B("div",ka,[_("span",{title:s.label,style:{overflow:"hidden"}},O(s.label),9,Ca)])):w("",!0),x(f).currentMode=="编辑"?(V(),B("div",ya,[s.level<4?(V(),U(t,{key:0,type:"primary",size:"small",link:"",icon:x(Pe),onClick:Z=>ke(F,s)},null,8,["icon","onClick"])):w("",!0),s.level<4?(V(),U(t,{key:1,type:"info",size:"small",link:"",icon:x(Ee),onClick:Z=>Ce(F,s)},null,8,["icon","onClick"])):w("",!0),l(d,{"confirm-button-text":"Yes","cancel-button-text":"No",icon:x(Le),"icon-color":"#626AEF",title:"确定删除该内容?",onConfirm:Z=>ye(F,s)},{reference:o(()=>[l(t,{type:"danger",size:"small",link:"",icon:x(Ne)},null,8,["icon"])]),_:2},1032,["icon","onConfirm"])])):w("",!0)])]),_:1},8,["data"])]),_("div",xa,[_("div",{class:"floating-button",onClick:e[0]||(e[0]=s=>L.value=!0)}," + "),l(q,{placement:"right",width:200,trigger:"hover"},{reference:o(()=>[_("div",Va,O(x(f).currentMode),1)]),default:o(()=>[l(C,{"default-active":x(f).getCurrentNode},{default:o(()=>[l(S,{index:"阅读",onClick:e[1]||(e[1]=s=>x(f).setCurrentMode("阅读"))},{default:o(()=>e[21]||(e[21]=[_("span",null,"阅读模式",-1)])),_:1,__:[21]}),l(S,{index:"编辑",onClick:e[2]||(e[2]=s=>x(f).setCurrentMode("编辑"))},{default:o(()=>e[22]||(e[22]=[_("span",null,"编辑内容",-1)])),_:1,__:[22]})]),_:1},8,["default-active"])]),_:1})])]),l(u,{modelValue:L.value,"onUpdate:modelValue":e[6]||(e[6]=s=>L.value=s),title:$.value?"编辑课程名称":"添加课程",width:"30%",onClose:fe},{footer:o(()=>[_("div",ha,[l(t,{onClick:e[4]||(e[4]=s=>L.value=!1)},{default:o(()=>e[24]||(e[24]=[c("取消",-1)])),_:1,__:[24]}),l(t,{type:"primary",onClick:e[5]||(e[5]=s=>me(X.value))},{default:o(()=>e[25]||(e[25]=[c(" 提交 ",-1)])),_:1,__:[25]})])]),default:o(()=>[l(M,{ref_key:"addCourseRef",ref:X,model:g.value,rules:ne,"label-width":"80px"},{default:o(()=>[l(y,{label:"课程名称",prop:"name"},{default:o(()=>[l(h,{modelValue:g.value.name,"onUpdate:modelValue":e[3]||(e[3]=s=>g.value.name=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(u,{modelValue:N.value,"onUpdate:modelValue":e[11]||(e[11]=s=>N.value=s),title:T.value?"编辑实验名称":"添加实验",width:"30%",onClose:ce},{footer:o(()=>[_("div",wa,[l(t,{onClick:e[9]||(e[9]=s=>N.value=!1)},{default:o(()=>e[26]||(e[26]=[c("取消",-1)])),_:1,__:[26]}),l(t,{type:"primary",onClick:e[10]||(e[10]=s=>pe(Y.value))},{default:o(()=>e[27]||(e[27]=[c(" 提交 ",-1)])),_:1,__:[27]})])]),default:o(()=>[l(M,{ref_key:"addLabRef",ref:Y,model:v.value,rules:ve,"label-width":"100px"},{default:o(()=>[l(y,{label:"实验名称",prop:"name"},{default:o(()=>[l(h,{modelValue:v.value.name,"onUpdate:modelValue":e[7]||(e[7]=s=>v.value.name=s)},null,8,["modelValue"])]),_:1}),l(y,{label:"知识库章节",prop:"sectionPrefix"},{default:o(()=>[l(h,{modelValue:v.value.sectionPrefix,"onUpdate:modelValue":e[8]||(e[8]=s=>v.value.sectionPrefix=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(u,{modelValue:A.value,"onUpdate:modelValue":e[20]||(e[20]=s=>A.value=s),title:G.value?"编辑模块":"添加模块",width:"30%",onClose:be},{footer:o(()=>[_("div",Ia,[l(t,{onClick:e[18]||(e[18]=s=>A.value=!1)},{default:o(()=>e[38]||(e[38]=[c("取消",-1)])),_:1,__:[38]}),l(t,{type:"primary",onClick:e[19]||(e[19]=s=>ge(W.value))},{default:o(()=>e[39]||(e[39]=[c(" 提交 ",-1)])),_:1,__:[39]})])]),default:o(()=>[l(M,{ref_key:"addLabModelRef",ref:W,model:i.value,rules:_e,"label-width":"100px"},{default:o(()=>[l(y,{label:"模块名称",prop:"name"},{default:o(()=>[l(h,{modelValue:i.value.name,"onUpdate:modelValue":e[12]||(e[12]=s=>i.value.name=s)},null,8,["modelValue"])]),_:1}),l(y,{label:"图标",prop:"icon"},{default:o(()=>[l(Q,{modelValue:i.value.icon,"onUpdate:modelValue":e[13]||(e[13]=s=>i.value.icon=s),placeholder:"请选择",style:{width:"240px"}},{default:o(()=>[l(b,{value:"fa-solid fa-circle-info"},{default:o(()=>[l(k,{icon:"fa-solid fa-circle-info"}),e[28]||(e[28]=c(" fa-solid fa-circle-info ",-1))]),_:1,__:[28]}),l(b,{value:"fas fa-microchip"},{default:o(()=>[l(k,{icon:"fas fa-microchip"}),e[29]||(e[29]=c(" fas fa-microchip ",-1))]),_:1,__:[29]}),l(b,{value:"fas fa-tasks"},{default:o(()=>[l(k,{icon:"fas fa-tasks"}),e[30]||(e[30]=c(" fas fa-tasks ",-1))]),_:1,__:[30]}),l(b,{value:"fas fa-brain"},{default:o(()=>[l(k,{icon:"fas fa-brain"}),e[31]||(e[31]=c(" fas fa-brain ",-1))]),_:1,__:[31]}),l(b,{value:"fa-solid fa-house"},{default:o(()=>[l(k,{icon:"fa-solid fa-house"}),e[32]||(e[32]=c(" fa-solid fa-house ",-1))]),_:1,__:[32]}),l(b,{value:"fa-solid fa-list"},{default:o(()=>[l(k,{icon:"fa-solid fa-list"}),e[33]||(e[33]=c(" fa-solid fa-list ",-1))]),_:1,__:[33]}),l(b,{value:"fa-solid fa-wand-magic-sparkles"},{default:o(()=>[l(k,{icon:"fa-solid fa-wand-magic-sparkles"}),e[34]||(e[34]=c(" fa-solid fa-wand-magic-sparkles ",-1))]),_:1,__:[34]}),l(b,{value:"fa-solid fa-book"},{default:o(()=>[l(k,{icon:"fa-solid fa-book"}),e[35]||(e[35]=c(" fa-solid fa-book ",-1))]),_:1,__:[35]}),l(b,{value:"fa-solid fa-hand"},{default:o(()=>[l(k,{icon:"fa-solid fa-hand"}),e[36]||(e[36]=c(" fa-solid fa-hand ",-1))]),_:1,__:[36]}),l(b,{value:"fa-solid fa-marker"},{default:o(()=>[l(k,{icon:"fa-solid fa-marker"}),e[37]||(e[37]=c(" fa-solid fa-marker ",-1))]),_:1,__:[37]})]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"需要ai提问",prop:"isNeedAiAsk"},{default:o(()=>[l(Q,{modelValue:i.value.isNeedAiAsk,"onUpdate:modelValue":e[14]||(e[14]=s=>i.value.isNeedAiAsk=s),placeholder:"请选择",style:{width:"240px"}},{default:o(()=>[l(b,{label:"需要",value:!0}),l(b,{label:"不需要",value:!1})]),_:1},8,["modelValue"])]),_:1}),i.value.isNeedAiAsk?(V(),U(y,{key:0,label:"问题个数",prop:"sectionPrefix"},{default:o(()=>[l(xe,{modelValue:i.value.askNum,"onUpdate:modelValue":e[15]||(e[15]=s=>i.value.askNum=s),min:1,max:10},null,8,["modelValue"])]),_:1})):w("",!0),i.value.isNeedAiAsk?(V(),U(y,{key:1,label:"知识库章节",prop:"sectionPrefix"},{default:o(()=>[l(h,{modelValue:i.value.sectionPrefix,"onUpdate:modelValue":e[16]||(e[16]=s=>i.value.sectionPrefix=s)},null,8,["modelValue"])]),_:1})):w("",!0),i.value.isNeedAiAsk?(V(),U(y,{key:2,label:"课前/课后",prop:"stage"},{default:o(()=>[l(Q,{modelValue:i.value.stage,"onUpdate:modelValue":e[17]||(e[17]=s=>i.value.stage=s),placeholder:"请选择",style:{width:"240px"}},{default:o(()=>[l(b,{label:"课前",value:"before-class"}),l(b,{label:"课后",value:"after-class"})]),_:1},8,["modelValue"])]),_:1})):w("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}});const Ea=te(Pa,[["__scopeId","data-v-3dcd17c9"]]),La={class:"emdContainer"},Na={class:"emd-catalogue-container"},Aa={class:"emd-content-container"},Ma=le({__name:"emdV3",setup(m){const D=ae(),f=n("main");return j(()=>D.routerKey,p=>{f.value=p}),(p,P)=>(V(),B("div",La,[_("div",Na,[l(Ea)]),_("div",Aa,[(V(),U(x(Oe),{key:f.value}))])]))}});const qa=te(Ma,[["__scopeId","data-v-e975fb13"]]);export{qa as default};
