import{h as ge,d as A,b as d,S as te,m as H,e as ye,a as i,c as b,g as e,w as l,i as w,n as N,F as B,j as O,q as h,t as K,s as f,G as ke,$ as le,a0 as ae,P as oe,af as ne,a2 as se,a3 as ue,a5 as Te,a6 as we,ad as re,x as W,y as X,_ as Y,k as M,f as j,as as ie,aP as me,N as be,au as de,O as xe,ae as Ie,E as Ce,a7 as he,U as Se,aA as Ve,aj as Ne,u as $e,r as De,an as Le,ao as Ee,v as Pe}from"./index-8f9ccc2f.js";/* empty css                */import{a as Ue,u as Fe,d as Re,G as qe,c as Ge,b as ze}from"./updateTaskTemplate-f6a23dc4.js";import{a as Me,A as Be,D as Oe}from"./deleteCourseDesign-d8ec59d6.js";import{g as je}from"./getCatalogue-914a408d.js";import{C as Ae}from"./courseDesign-baa6b6b5.js";import{U as pe,G as He,a as Je,D as ce,b as ve,C as Qe}from"./getCourseNode-d7834a6f.js";import{c as Ke}from"./getTaskTemplates-4d34e142.js";import{D as _e}from"./deleteVidoeById-b31f1c9d.js";import{G as fe}from"./getRootNodeList-a4187607.js";import{G as We}from"./getCaseVideo-a934e415.js";function Xe(U){return ge({url:"/md_content/create",method:"POST",data:U})}const Ye={id:"pane-first",class:"pane",key:"0"},Ze={class:"cover-upload"},et=["src"],tt=A({__name:"one",props:{courseId:Number},emits:["nextStep","created"],setup(U,{emit:D}){const S=U,c=d(),r=d(),m=d({id:null,name:"",introduction:"",introduce:"",target:"",cover:"",completion:null,guidance:"",third:1,deviceId:null,mdCourse:null}),k=d([]),s=d([]),I=d({"x-access-token":localStorage.getItem("x-access-token"),"x-access-type":localStorage.getItem("x-access-type")}),$=te({name:[{required:!0,message:"请输入课程名称",trigger:"blur"}],introduction:[{required:!0,message:"请输入课程简介",trigger:"blur"}],introduce:[{required:!0,message:"请输入课程详细介绍",trigger:"blur"}],cover:[{required:!0,message:"请上传封面",trigger:"blur"}],mdCourse:[{required:!0,message:"请选择课程指导书",trigger:"blur"}]}),p=n=>{n.validate((t,a)=>{t?(m.value.id=c.value,Xe(Object.assign({},m.value)).then(u=>{u.state==200?(m.value=u.data,c.value=u.data.id,v(u.data),g(m.value.completion)):f.error(u.message)})):f.error})},q=D,g=n=>{q("nextStep",n)},v=n=>{q("created",n)},_=n=>{n!=null&&ke(n).then(t=>{t.state==200?m.value=t.data:f.error(t.message)})},L=()=>{je().then(n=>{n.state==200&&(s.value=n.data)})},R=()=>{Me().then(n=>{n.state==200?k.value=n.data:f.error("获取iecube设备列表异常")})},z=(n,t)=>{n.state==200&&(m.value.cover=n.data.filename)},y=n=>{if(!(n.type=="image/jpeg"||n.type=="image/png"||n.type=="image/gif"))f.error("支持 JPG，PNG， GIF！");else if(n.size/1024/1024>5)return f.error("图片不要大于 2MB!"),!1;return!0};return H(()=>{c.value=S.courseId,_(c.value),L(),R()}),(n,t)=>{const a=le,u=ae,o=ye("Plus"),x=oe,P=ne,F=se,G=ue,V=Te,C=we,J=re,Z=W,ee=X;return i(),b("div",Ye,[e(J,{ref_key:"contentFormRef",ref:r,model:m.value,rules:$,"label-width":"120px",class:"contentForm"},{default:l(()=>[e(u,{label:"课程名称",prop:"name"},{default:l(()=>[e(a,{modelValue:m.value.name,"onUpdate:modelValue":t[0]||(t[0]=E=>m.value.name=E)},null,8,["modelValue"])]),_:1}),e(u,{label:"课程简介",prop:"introduction"},{default:l(()=>[e(a,{type:"textarea",autosize:{minRows:2,maxRows:4},modelValue:m.value.introduction,"onUpdate:modelValue":t[1]||(t[1]=E=>m.value.introduction=E)},null,8,["modelValue"])]),_:1}),e(u,{label:"课程详细介绍",prop:"introduce"},{default:l(()=>[e(a,{type:"textarea",autosize:{minRows:2,maxRows:4},modelValue:m.value.introduce,"onUpdate:modelValue":t[2]||(t[2]=E=>m.value.introduce=E)},null,8,["modelValue"])]),_:1}),e(u,{label:"封面",prop:"cover"},{default:l(()=>[w("div",Ze,[e(P,{class:"cover-uploader",action:"/dev-api/files/e/image","show-file-list":!1,headers:I.value,"on-success":z,"before-upload":y},{default:l(()=>[m.value.cover?(i(),b("img",{key:0,src:"/local-resource/image/"+m.value.cover,class:"cover"},null,8,et)):(i(),N(x,{key:1,class:"cover-uploader-icon"},{default:l(()=>[e(o)]),_:1}))]),_:1},8,["headers"])])]),_:1}),e(u,{label:"指导书",prop:"mdCourse"},{default:l(()=>[e(G,{modelValue:m.value.mdCourse,"onUpdate:modelValue":t[3]||(t[3]=E=>m.value.mdCourse=E),placeholder:"选择课程",style:{width:"240px"}},{default:l(()=>[(i(!0),b(B,null,O(s.value,(E,T)=>(i(),N(F,{key:T,label:E.courseName,value:E.courseId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"实验设备",prop:"deviceId"},{default:l(()=>[e(C,{modelValue:m.value.deviceId,"onUpdate:modelValue":t[4]||(t[4]=E=>m.value.deviceId=E)},{default:l(()=>[e(V,{label:0},{default:l(()=>t[6]||(t[6]=[h("无设备",-1)])),_:1,__:[6]}),(i(!0),b(B,null,O(k.value,E=>(i(),N(V,{label:E.id},{default:l(()=>[h(K(E.name),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),e(ee,{class:"bottom-row"},{default:l(()=>[e(Z,{type:"primary",onClick:t[5]||(t[5]=E=>p(r.value))},{default:l(()=>t[7]||(t[7]=[h("下一步",-1)])),_:1,__:[7]})]),_:1})])}}});const lt=Y(tt,[["__scopeId","data-v-72334f2e"]]),at={id:"pane-fourth",class:"pane",key:"3"},ot={style:{margin:"30px 0px"}},nt={key:0},st={key:0},ut={style:{margin:"30px 0px"}},rt={key:0},it={key:0},dt=A({__name:"two",props:{courseId:Number},emits:["nextStep","lastStep"],setup(U,{emit:D}){const S=U;H(()=>{k.value=S.courseId,I()});const c=D,r=u=>{c("nextStep",u)},m=()=>{c("lastStep")},k=d(0),s=d([]),I=()=>{Ae(k.value).then(u=>{u.state==200?s.value=u.data:f.error("获取课程设计内容异常")})},$=d(),p=d({id:null,graduationRequirementName:"",graduationPointList:[],courseTargetList:[]}),q=te({graduationRequirementName:[{required:!0,message:"请输入毕业要求",trigger:"blur"}],graduationPointList:[{required:!0,validator:function(u,o,x){o[0].point==""?x(new Error("没有对应的毕业要求指标点")):x()},trigger:"change"}],courseTargetList:[{required:!0,validator:function(u,o,x){o[0].point==""?x(new Error("没有对应的课程目标")):x()},trigger:"change"}]}),g=d(""),v=d("");d("");const _=()=>{if(g.value=="")return;let u=d({id:null,parentId:null,name:g.value});p.value.graduationPointList.push(u.value),g.value=""},L=u=>{p.value.graduationPointList.splice(u,1)},R=()=>{if(v.value=="")return;let u=d({id:null,parentId:null,name:v.value});p.value.courseTargetList.push(u.value),v.value=""},z=u=>{p.value.courseTargetList.splice(u,1)},y=async u=>{u&&await u.validate((o,x)=>{if(o){let P=Object.assign({},p.value);Be(k.value,P).then(F=>{F.state==200?(s.value=F.data,n()):f.error(F.message)})}})},n=()=>{p.value.graduationRequirementName="",p.value.graduationPointList.splice(0,p.value.graduationPointList.length),p.value.courseTargetList.splice(0,p.value.courseTargetList.length)},t=u=>{Oe(k.value,u).then(o=>{o.state==200?s.value=o.data:f.error(o.message)})},a=()=>{pe(k.value,1).then(u=>{if(u.state==200){let o=u.data.completion;r(o)}else f.error(u.message)})};return(u,o)=>{const x=be,P=W,F=de,G=xe,V=le,C=ae,J=Ie,Z=re,ee=Ce,E=X;return i(),b("div",at,[o[13]||(o[13]=w("div",{style:{margin:"20px 0px"}},[w("span",null," 本节需要明确课程目标和对应知识点的匹配关系 ")],-1)),w("div",ot,[e(G,{data:s.value,border:!0,style:{width:"100%"}},{default:l(()=>[e(x,{prop:"graduationRequirementName",label:"毕业要求"}),e(x,{label:"毕业要求指标点"},{default:l(T=>[s.value.length>0&&s.value[0]!=null?(i(),b("div",nt,[(i(!0),b(B,null,O(T.row.graduationPointList.length,Q=>(i(),b("li",null,K(T.row.graduationPointList[Q-1].name),1))),256))])):M("",!0)]),_:1}),e(x,{label:"对应的课程目标"},{default:l(T=>[s.value.length>0&&s.value[0]!=null?(i(),b("div",st,[(i(!0),b(B,null,O(T.row.courseTargetList.length,Q=>(i(),b("li",null,K(T.row.courseTargetList[Q-1].name),1))),256))])):M("",!0)]),_:1}),e(x,{prop:"",label:"操作",width:"100px"},{default:l(T=>[e(F,{title:"确定删除吗?",onConfirm:Q=>t(T.row.graduationRequirementId)},{reference:l(()=>[e(P,{link:"",type:"danger",size:"small",icon:j(ie)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),w("div",ut,[e(ee,{style:{"min-height":"280px"},shadow:"never"},{header:l(()=>o[8]||(o[8]=[w("div",null,[w("span",null,"添加课程目标和对应知识点匹配关系")],-1)])),default:l(()=>[w("div",null,[e(Z,{"label-width":"160px",ref_key:"designFormRef",ref:$,model:p.value,rules:q},{default:l(()=>[e(C,{label:"毕业要求：",prop:"graduationRequirementName"},{default:l(()=>[e(V,{modelValue:p.value.graduationRequirementName,"onUpdate:modelValue":o[0]||(o[0]=T=>p.value.graduationRequirementName=T),style:{"max-width":"500px"},placeholder:"请输入毕业要求"},null,8,["modelValue"])]),_:1}),e(C,{label:"毕业要求指标点：",prop:"graduationPointList"},{default:l(()=>[p.value.graduationPointList.length>0?(i(),b("div",rt,[(i(!0),b(B,null,O(p.value.graduationPointList.length,T=>(i(),N(J,{key:T,class:"mx-1",closable:"",onClose:Q=>L(T-1)},{default:l(()=>[h(K(p.value.graduationPointList[T-1].name),1)]),_:2},1032,["onClose"]))),128))])):M("",!0)]),_:1}),e(C,null,{default:l(()=>[e(V,{style:{"max-width":"500px","margin-right":"20px"},modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=T=>g.value=T),placeholder:"请分条输入毕业要求对应指标点，每一条完成后点击右侧保存"},null,8,["modelValue"]),e(P,{type:"primary",circle:"",size:"small",icon:j(me),onClick:o[2]||(o[2]=T=>_())},null,8,["icon"])]),_:1}),e(C,{label:"对应课程目标：",prop:"graduationPointList"},{default:l(()=>[p.value.courseTargetList.length>0?(i(),b("div",it,[(i(!0),b(B,null,O(p.value.courseTargetList.length,T=>(i(),N(J,{key:T,class:"mx-1",closable:"",onClose:Q=>z(T-1)},{default:l(()=>[h(K(p.value.courseTargetList[T-1].name),1)]),_:2},1032,["onClose"]))),128))])):M("",!0)]),_:1}),e(C,null,{default:l(()=>[e(V,{style:{"max-width":"500px","margin-right":"20px"},modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=T=>v.value=T),placeholder:"请分条输入毕业要求对应课程目标，每一条完成后点击右侧保存"},null,8,["modelValue"]),e(P,{type:"primary",circle:"",size:"small",icon:j(me),onClick:o[4]||(o[4]=T=>R())},null,8,["icon"])]),_:1}),e(C,null,{default:l(()=>[e(P,{type:"primary",size:"small",onClick:o[5]||(o[5]=T=>y($.value))},{default:l(()=>o[9]||(o[9]=[h("添加",-1)])),_:1,__:[9]}),e(P,{size:"small",onClick:o[6]||(o[6]=T=>n())},{default:l(()=>o[10]||(o[10]=[h("清除内容",-1)])),_:1,__:[10]})]),_:1})]),_:1},8,["model","rules"])])]),_:1})]),e(E,{class:"bottom-row"},{default:l(()=>[e(P,{onClick:m},{default:l(()=>o[11]||(o[11]=[h("上一步",-1)])),_:1,__:[11]}),e(P,{type:"primary",onClick:o[7]||(o[7]=T=>a())},{default:l(()=>o[12]||(o[12]=[h("下一步",-1)])),_:1,__:[12]})]),_:1})])}}});const pt=Y(dt,[["__scopeId","data-v-684c63c9"]]);function mt(U){return ge({url:"/md/ch/list/"+U,method:"GET"})}const ct=A({__name:"mdExperimentalDesign",props:{course:Object,isEdit:Boolean,oldTaskTemplate:Object,lastTaskNum:Number},emits:["addSuccess","exitUpdate"],setup(U,{emit:D}){const S=U;H(()=>{c.value=S.course.id,r.value=S.course,m.value=S.lastTaskNum,s.value.taskDevice=r.value.deviceId,s.value.num=m.value+1,p(),S.isEdit&&(s.value=S.oldTaskTemplate)});const c=d(0),r=d(),m=d(0),k=d(),s=d({id:null,contentId:c.value,num:null,taskName:"",taskCover:"",taskDevice:null,taskDetails:null,taskMdDoc:null,classHour:null,weighting:null}),I=d([]);d("");const $=d([]),p=()=>{mt(r.value.mdCourse).then(t=>{t.state==200?$.value=t.data:f.error(t.message)})},q=()=>{for(let t=0;t<$.value.length;t++)if($.value[t].id==s.value.taskMdDoc){s.value.taskName=$.value[t].name;return}},g=te({taskName:[{required:!0,message:"请输入实验名称",trigger:"blur"}],num:[{required:!0,message:"请输入实验序号",trigger:"blur"}],taskMdDoc:[{required:!0,message:"请选择实验指导书",trigger:"blur"}],weighting:[{required:!0,message:"请设置实验权重",trigger:"blur"}],classHour:[{required:!0,message:"请设置实验课时",trigger:"blur"}]}),v=D,_=t=>{v("addSuccess",t)},L=()=>{v("exitUpdate")},R=async t=>{t&&await t.validate((a,u)=>{if(a){s.value.contentId=c.value,s.value.taskDevice=r.value.deviceId,console.log(s.value);let o=Object.assign({},s.value);Ue(o).then(x=>{x.state==200?(n(),_(x.data),f.success("添加成功")):f.error(x.message)})}else console.log("error submit!",u)})},z=async t=>{t&&await t.validate((a,u)=>{if(a){let o=Object.assign({},s.value);Fe(o).then(x=>{x.state==200?(n(),_(x.data),L(),f.success("更新成功")):f.error(x.message)})}else console.log("error submit!",u)})},y=()=>{n(),L()},n=()=>{s.value.taskName="",s.value.num=null,s.value.taskCover="",s.value.taskDetails=null,s.value.taskMdDoc=null,I.value=[]};return(t,a)=>{const u=he,o=ae,x=se,P=ue,F=le,G=W,V=re;return i(),b("div",null,[e(V,{"label-width":"150px",ref_key:"addTaskFormRef",ref:k,model:s.value,rules:g},{default:l(()=>[e(o,{label:"实验序号：",prop:"num"},{default:l(()=>[e(u,{min:1,max:25,modelValue:s.value.num,"onUpdate:modelValue":a[0]||(a[0]=C=>s.value.num=C)},null,8,["modelValue"])]),_:1}),e(o,{label:"实验指导书：",prop:"taskMdDoc"},{default:l(()=>[e(P,{modelValue:s.value.taskMdDoc,"onUpdate:modelValue":a[1]||(a[1]=C=>s.value.taskMdDoc=C),placeholder:"选择指导书",style:{width:"420px"},onChange:a[2]||(a[2]=C=>q())},{default:l(()=>[(i(!0),b(B,null,O($.value,(C,J)=>(i(),N(x,{key:J,label:C.name,value:C.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(o,{label:"实验名称：",prop:"taskName"},{default:l(()=>[e(F,{style:{width:"420px"},modelValue:s.value.taskName,"onUpdate:modelValue":a[3]||(a[3]=C=>s.value.taskName=C)},null,8,["modelValue"])]),_:1}),e(o,{label:"实验权重(%)：",prop:"weighting"},{default:l(()=>[e(u,{min:0,max:100,modelValue:s.value.weighting,"onUpdate:modelValue":a[4]||(a[4]=C=>s.value.weighting=C)},null,8,["modelValue"])]),_:1}),e(o,{label:"实验课时：",prop:"classHour"},{default:l(()=>[e(u,{modelValue:s.value.classHour,"onUpdate:modelValue":a[5]||(a[5]=C=>s.value.classHour=C)},null,8,["modelValue"])]),_:1}),S.isEdit?(i(),N(o,{key:1,style:{"margin-top":"50px"}},{default:l(()=>[e(G,{type:"primary",size:"small",onClick:a[8]||(a[8]=C=>z(k.value))},{default:l(()=>a[12]||(a[12]=[h("完成",-1)])),_:1,__:[12]}),e(G,{size:"small",onClick:a[9]||(a[9]=C=>y())},{default:l(()=>a[13]||(a[13]=[h("取消",-1)])),_:1,__:[13]})]),_:1})):(i(),N(o,{key:0,style:{"margin-top":"50px"}},{default:l(()=>[e(G,{type:"primary",size:"small",onClick:a[6]||(a[6]=C=>R(k.value))},{default:l(()=>a[10]||(a[10]=[h("添加实验",-1)])),_:1,__:[10]}),e(G,{size:"small",onClick:a[7]||(a[7]=C=>n())},{default:l(()=>a[11]||(a[11]=[h("清除内容",-1)])),_:1,__:[11]})]),_:1}))]),_:1},8,["model","rules"])])}}}),vt={id:"pane-fiveth",class:"pane",key:"4"},_t={style:{margin:"30px 0px"}},ft={style:{margin:"30px 0px"}},gt={key:0},yt={key:1},kt=A({__name:"three",props:{courseId:Number,course:Object},emits:["nextStep","lastStep"],setup(U,{emit:D}){const S=U,c=d(0),r=d(),m=d(0);H(()=>{c.value=S.courseId,r.value=S.course,k(c.value)});const k=y=>{Ke(y).then(n=>{n.state==200?(p.value=n.data,p.value.length>0&&(m.value=p.value[p.value.length-1].num)):f.error("获取课程实验列表异常")})},s=D,I=y=>{s("nextStep",y)},$=()=>{s("lastStep")},p=d([]),q=y=>{p.value=y,p.value.length>0&&(m.value=p.value[p.value.length-1].num)},g=()=>{L.value=!1},v=y=>{Re(c.value,y).then(n=>{n.state==200?p.value=n.data:f.error(n.message)})},_=()=>{p.value.length<1&&f.warning("请完成实验设计"),pe(c.value,2).then(y=>{if(y.state==200){let n=y.data.completion;I(n)}else f.error(y.message)})},L=d(!1),R=d(),z=y=>{console.log(p.value[y]),R.value=JSON.parse(JSON.stringify(p.value[y])),L.value=!0};return(y,n)=>{const t=be,a=W,u=de,o=xe,x=Ce,P=X;return i(),b("div",vt,[n[5]||(n[5]=w("div",{style:{margin:"30px 0px"}},[w("span",null,"本节需要完善该课程的实验模版")],-1)),w("div",_t,[e(o,{data:p.value,border:!0,style:{width:"100%"}},{default:l(()=>[e(t,{prop:"num",label:"实验序号",width:"60px"}),e(t,{prop:"taskName",label:"实验名称"}),e(t,{prop:"mdChapter.name",label:"实验指导书"}),e(t,{prop:"weighting",label:"实验权重"}),e(t,{prop:"classHour",label:"实验课时"}),e(t,{prop:"",label:"操作",width:"100px"},{default:l(F=>[e(a,{link:"",type:"primary",size:"small",icon:j(Se),onClick:G=>z(F.$index)},null,8,["icon","onClick"]),e(u,{title:"确定删除吗?",onConfirm:G=>v(F.row.id)},{reference:l(()=>[e(a,{link:"",type:"danger",size:"small",icon:j(ie)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),w("div",ft,[e(x,{style:{"min-height":"280px"},shadow:"never"},{header:l(()=>[L.value?(i(),b("div",yt,n[2]||(n[2]=[w("span",null,"编辑实验",-1)]))):(i(),b("div",gt,n[1]||(n[1]=[w("span",null,"添加实验",-1)])))]),default:l(()=>[(i(),N(ct,{key:Date.now().toString(),course:r.value,isEdit:L.value,oldTaskTemplate:R.value,lastTaskNum:m.value,onAddSuccess:q,onExitUpdate:g},null,8,["course","isEdit","oldTaskTemplate","lastTaskNum"]))]),_:1})]),e(P,{class:"bottom-row"},{default:l(()=>[e(a,{onClick:$},{default:l(()=>n[3]||(n[3]=[h("上一步",-1)])),_:1,__:[3]}),e(a,{type:"primary",onClick:n[0]||(n[0]=F=>_())},{default:l(()=>n[4]||(n[4]=[h("下一步",-1)])),_:1,__:[4]})]),_:1})])}}});const bt=Y(kt,[["__scopeId","data-v-54d5fefb"]]),xt={key:0},Ct={class:"cover-upload"},Tt=["src"],wt={key:1,style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},It={key:2,style:{"margin-top":"2em"}},ht=A({__name:"four",props:{course:Object},emits:["nextStep","lastStep"],setup(U,{emit:D}){const S=U,c=d(),r=d(),m=d();d();const k=d([]),s=d({nodeId:null,caseId:c.value}),I=d({"x-access-token":localStorage.getItem("x-access-token"),"x-access-type":localStorage.getItem("x-access-type")}),$=()=>{Je(c.value,r.value.fourthType).then(t=>{t.state!=200&&f.error("更新展示方式出错了")}),r.value.fourthType==="video"&&(r.value.fourth&&ce(r.value.fourth),s.value.nodeId=null,L()),r.value.fourthType==="image"&&(m.value&&_e(m.value.id),s.value.nodeId=null),r.value.fourthType==="map"&&(m.value&&_e(m.value.id),r.value.fourth&&ce(r.value.fourth),fe().then(t=>{t.state==200&&(k.value=t.data)})),r.value.fourth=null},p=t=>t.type!="image/png"?(f.error("请上传PNG类型的图片"),!1):t.size/1024/1024>2?(f.error("图片最大2MB!"),!1):!0,q=(t,a)=>{t.state==200&&(r.value.fourth=t.data.filename)},g=t=>t.type!="video/mp4"?(f.error("请上传MP4类型的视频"),!1):t.size/1024/1024>2048?(f.error("视频最大2G!"),!1):!0,v=(t,a)=>{t.state==200&&(_.value=t.data)},_=d([]),L=()=>{We(c.value).then(t=>{t.state==200?_.value=t.data:f.error(t.message)})};H(()=>{r.value=S.course,c.value=S.course.id,r.value.fourthType==="video"&&L(),r.value.fourthType==="map"&&(fe().then(t=>{t.state==200&&(k.value=t.data)}),He(c.value).then(t=>{t.state==200&&(s.value=t.data)}))});const R=D,z=t=>{R("nextStep",t)},y=()=>{R("lastStep")},n=async()=>{if((r.value.fourthType==="video"||r.value.fourthType==="image")&&await ve(c.value,r.value.fourth).then(t=>{if(t.state!=200){f.error(t.message);return}}),r.value.fourthType==="map")if(await ve(c.value,null).then(t=>{if(t.state!=200){f.error(t.message);return}}),s.value.nodeId!=null)await Qe(c.value,s.value.nodeId).then(t=>{if(t.state!=200){f.error(t.message);return}});else{f.error("请选择映射图");return}await pe(c.value,3).then(t=>{if(t.state==200){let a=t.data.completion;z(a)}else f.error(t.message)})};return(t,a)=>{const u=se,o=ue,x=X,P=oe,F=ne,G=W;return i(),b("div",null,[e(x,null,{default:l(()=>[e(o,{modelValue:r.value.fourthType,"onUpdate:modelValue":a[0]||(a[0]=V=>r.value.fourthType=V),placeholder:"选择展示方式",style:{width:"240px"},onChange:a[1]||(a[1]=V=>$())},{default:l(()=>[(i(),N(u,{key:"image",label:"图片",value:"image"})),(i(),N(u,{key:"video",label:"视频",value:"video"})),(i(),N(u,{key:"map",label:"映射关系",value:"map"}))]),_:1},8,["modelValue"])]),_:1}),r.value.fourthType==="image"?(i(),b("div",xt,[w("div",Ct,[e(F,{class:"cover-uploader",action:"/dev-api/files/upimage/",headers:I.value,"show-file-list":!1,"on-success":q,"before-upload":p},{default:l(()=>[r.value.fourth?(i(),b("img",{key:0,src:"/local-resource/image/"+r.value.fourth,class:"cover"},null,8,Tt)):(i(),N(P,{key:1,class:"cover-uploader-icon"},{default:l(()=>[e(j(Ve))]),_:1}))]),_:1},8,["headers"])])])):r.value.fourthType==="video"?(i(),b("div",wt,[e(F,{"file-list":_.value,"onUpdate:fileList":a[2]||(a[2]=V=>_.value=V),class:"upload-demo",headers:I.value,action:"/dev-api/video/n/up/"+c.value,"on-success":v,"before-upload":g},{tip:l(()=>a[7]||(a[7]=[w("div",{class:"el-upload__tip"}," 视频最大1GB ",-1)])),default:l(()=>[e(G,{type:"primary",style:{width:"200px"}},{default:l(()=>a[6]||(a[6]=[h("上传",-1)])),_:1,__:[6]})]),_:1},8,["file-list","headers","action"])])):(i(),b("div",It,[e(o,{modelValue:s.value.nodeId,"onUpdate:modelValue":a[3]||(a[3]=V=>s.value.nodeId=V),placeholder:"选择映射关系",style:{width:"240px"},onChange:a[4]||(a[4]=V=>$())},{default:l(()=>[(i(!0),b(B,null,O(k.value,(V,C)=>(i(),N(u,{key:"node"+C,label:V.name,value:V.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])),e(x,{class:"bottom-row"},{default:l(()=>[e(G,{onClick:y},{default:l(()=>a[8]||(a[8]=[h("上一步",-1)])),_:1,__:[8]}),e(G,{type:"primary",onClick:a[5]||(a[5]=V=>n())},{default:l(()=>a[9]||(a[9]=[h("下一步",-1)])),_:1,__:[9]})]),_:1})])}}});const St=Y(ht,[["__scopeId","data-v-03f4ff68"]]),Vt={id:"pane-seventh",class:"pane",key:"6"},Nt={style:{display:"flex","flex-direction":"column"}},$t={style:{padding:"20px"}},Dt=A({__name:"five",props:{courseId:Number},emits:["done","lastStep"],setup(U,{emit:D}){const S=U,c=D,r=()=>{c("done")},m=()=>{c("lastStep")},k=d(0);H(()=>{k.value=S.courseId,q(k.value)});const s=d({"x-access-token":localStorage.getItem("x-access-token"),"x-access-type":localStorage.getItem("x-access-type")}),I=d([]),$=v=>v.size/1024/1024/1024>1?(f({showClose:!0,message:"文件最大不能超过1GB",type:"success"}),!1):!0,p=v=>{v.state==200&&(I.value=v.data)},q=async v=>{await qe(v).then(_=>{_.state==200?I.value=_.data:f.error("获取资源包失败"+_.message)})},g=v=>{Ge(k.value,v).then(_=>{_.state==200?I.value=_.data:f.error(_.message)})};return(v,_)=>{const L=ye("upload-filled"),R=oe,z=ne,y=W,n=de,t=X;return i(),b("div",Vt,[w("div",Nt,[w("div",$t,[e(z,{class:"upload-demo",drag:"",multiple:"",action:"/dev-api/content/upload_pkg/"+k.value,headers:s.value,"before-upload":$,"on-success":p},{tip:l(()=>_[0]||(_[0]=[w("div",{class:"el-upload__tip"}," 单个文件最大不超过100MB。 ",-1)])),default:l(()=>[e(R,{class:"el-icon--upload"},{default:l(()=>[e(L)]),_:1}),_[1]||(_[1]=w("div",{class:"el-upload__text"},[h(" Drop file here or "),w("em",null,"click to upload")],-1))]),_:1,__:[1]},8,["action","headers"])]),w("div",null,[(i(!0),b(B,null,O(I.value.length,a=>(i(),N(t,{style:{"text-align":"left"}},{default:l(()=>[e(y,{type:"primary",icon:j(Ne),link:""},{default:l(()=>[h(K(I.value[a-1].originFilename),1)]),_:2},1032,["icon"]),e(n,{title:"确定删除吗?",onConfirm:u=>g(I.value[a-1].id)},{reference:l(()=>[e(y,{link:"",type:"danger",size:"small",icon:j(ie)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024))),256))])]),e(t,{class:"bottom-row"},{default:l(()=>[e(y,{onClick:m},{default:l(()=>_[2]||(_[2]=[h("上一步",-1)])),_:1,__:[2]}),e(y,{type:"primary",onClick:r},{default:l(()=>_[3]||(_[3]=[h("完成",-1)])),_:1,__:[3]})]),_:1})])}}});const Lt=Y(Dt,[["__scopeId","data-v-8f7fd560"]]),Et={style:{"margin-top":"40px"}},At=A({__name:"index",setup(U){const D=d({id:null,name:"",introduction:"",introduce:"",target:"",cover:"",completion:null,guidance:"",third:1,deviceId:null,mdCourse:null}),S=$e(),c=d(0),r=d(0),m=d(0),k=g=>{g>m.value+1||(r.value=g)},s=g=>{r.value=g+1,g>m.value&&(m.value=g)},I=()=>{r.value-=1},$=g=>{console.log(g),c.value=g.id,D.value=g},p=g=>{g&&ke(g).then(v=>{v.state==200?(D.value=v.data,r.value=D.value.completion+1,m.value=D.value.completion):f.error(v.message)})},q=()=>{ze(c.value).then(g=>{g.state==200?De.push({name:S.meta.parentName}):f.error(g.message)})};return H(()=>{c.value=S.params.courseId,p(c.value)}),(g,v)=>{const _=Le,L=Ee,R=Pe,z=X;return i(),b("div",null,[e(z,null,{default:l(()=>[e(R,{span:24},{default:l(()=>[e(L,{active:r.value,simple:""},{default:l(()=>[e(_,{title:"基本信息",onClick:v[0]||(v[0]=y=>k(0))}),e(_,{title:"课程设计",onClick:v[1]||(v[1]=y=>k(1))}),e(_,{title:"实验设计",onClick:v[2]||(v[2]=y=>k(2))}),e(_,{title:"理实映射",onClick:v[3]||(v[3]=y=>k(3))}),e(_,{title:"附件资源",onClick:v[4]||(v[4]=y=>k(4))})]),_:1},8,["active"])]),_:1})]),_:1}),w("div",Et,[r.value==0?(i(),N(lt,{key:0,courseId:c.value,onNextStep:s,onCreated:$},null,8,["courseId"])):M("",!0),r.value==1?(i(),N(pt,{key:1,courseId:c.value,onLastStep:I,onNextStep:s},null,8,["courseId"])):M("",!0),r.value==2?(i(),N(bt,{key:2,courseId:c.value,course:D.value,onLastStep:I,onNextStep:s},null,8,["courseId","course"])):M("",!0),r.value==3?(i(),N(St,{key:3,course:D.value,onLastStep:I,onNextStep:s},null,8,["course"])):M("",!0),r.value==4?(i(),N(Lt,{key:4,courseId:c.value,onLastStep:I,onDone:q},null,8,["courseId"])):M("",!0)])])}}});export{At as default};
