import{h as O,d as E,b as i,o as D,D as M,a as e,c as l,i as s,f as _,s as g,g as u,k as C,$ as V,w as x,F as $,j as N,n as L,t as q,a5 as j,a6 as Q,ac as z,b3 as F,u as K,z as X,q as P,x as W,N as Y,O as Z,a8 as ee,_ as te}from"./index-8f9ccc2f.js";import{V as le}from"./index-4be9d6ee.js";import{g as U,G as B}from"./getBlockDetail-fade864f.js";import{g as ae,B as y}from"./block-d7a047ff.js";import{_ as I}from"./textPreview.vue_vue_type_script_setup_true_lang-7cc023c2.js";import{G as oe,a as ne}from"./getBlockBySection-6c35c21c.js";import{e as se}from"./emdV2Store-a3b70642.js";/* empty css               */import{G as re}from"./getQuestionTemplates-421cb2dc.js";import"./v5-b62ae20a.js";import"./marked.esm-fed877e7.js";import"./browser-19b77043.js";import"./katex-4b21be29.js";import"./purify.es-9c590e79.js";function de(v){return O({url:"elaborate/md/block//up/detail",method:"POST",data:v})}const ue={style:{width:"100%",height:"auto",display:"flex","flex-direction":"column","align-items":"flex-start"},class:"ist-theam"},ce=["id"],ie=E({__name:"contentEdit",props:{blockId:Number},setup(v){const r=v,p=i(),t=i(),o=()=>{de(p.value).then(n=>{n.state!=200&&g.error("保存数据失败 "+n.message)})},k=()=>{B(r.blockId).then(n=>{n.state==200?(p.value=n.data,t.value&&(t.value.setValue(p.value.content),t.value.enable())):g.error("数据加载失败")})},b=async()=>new Promise(n=>{t.value=new le(U(r.blockId),{width:"100%",theme:"classic",preview:{theme:{current:"ant-design"}},cache:{enable:!1},toolbar:["headings","bold","italic","strike","link","|","list","ordered-list","check","|","quote","line","code","inline-code","insert-before","insert-after","|","upload","table","|","undo","redo"],toolbarConfig:{hide:!0},placeholder:"请在此处输入内容",upload:{accept:"image/*",url:"/dev-api/files/e/image",linkToImgUrl:"/dev-api/files/e/image",fieldName:"file",multiple:!1,success(a,f){t.value.insertValue("!["+JSON.parse(f).data.title+"](/dev-api/"+JSON.parse(f).data.url+")")},error:a=>{g.error(JSON.parse(a).message)},filename:a=>a},after:()=>{t.value.disabled(),n()},blur:()=>{p.value.content=t.value.getValue(),p.value.catalogue=JSON.stringify(ae(p.value.content)),o()}})});return D(()=>{setTimeout(async()=>{await b(),k()},10)}),M(()=>{t.value&&t.value.destroy()}),(n,a)=>(e(),l("div",ue,[s("div",{id:_(U)(v.blockId),style:{flex:"1"}},null,8,ce)]))}}),pe={key:0,class:"ist-theam my-4 p-5 bg-gray-50 rounded-lg border-l-4 border-blue-500 scroll-mt-[80px]",tabindex:"0"},be={class:"scroll-mt-[80px]"},_e=E({__name:"qa",props:{blockId:Number},setup(v){const r=v,p=i(!1),t=i(),o=i({id:r.blockId,parentId:null,type:"",title:"",content:"",catalogue:"",confData:"",referenceData:"",dataTemplate:"",payload:""}),k=()=>new Promise((b,n)=>{B(r.blockId).then(a=>{a.state==200?(o.value=a.data,o.value.payload!=null&&o.value.payload.length!==0&&(t.value=JSON.parse(o.value.payload)),p.value=!0,b()):(g.error("数据加载失败"),n())})});return D(()=>{setTimeout(async()=>{await k()},500)}),(b,n)=>{const a=V;return p.value?(e(),l("div",pe,[u(I,{content:t.value.question.question},null,8,["content"]),s("div",be,[u(a,{class:"w-full",type:"textarea",autosize:{minRows:4},placeholder:"作答区域"})])])):C("",!0)}}}),ve={key:0,class:"ist-theam my-4 p-5 bg-gray-50 rounded-lg border-l-4 border-blue-500 scroll-mt-[80px]",tabindex:"0"},me={class:"flex flex-col"},ye={class:"flex items-center nomr"},fe={class:"mr-2"},ke=E({__name:"choice",props:{blockId:Number},setup(v){const r=v,p=i(!1),t=i(),o=i({id:r.blockId,parentId:null,type:"",title:"",content:"",catalogue:"",confData:"",referenceData:"",dataTemplate:"",payload:""}),k=()=>new Promise((b,n)=>{B(r.blockId).then(a=>{a.state==200?(o.value=a.data,o.value.payload!=null&&o.value.payload.length!==0&&(t.value=JSON.parse(o.value.payload)),p.value=!0,b()):(g.error("数据加载失败"),n())})});return D(()=>{setTimeout(async()=>{await k()},500)}),(b,n)=>{const a=j,f=Q;return p.value?(e(),l("div",ve,[u(I,{content:t.value.question.question},null,8,["content"]),s("div",me,[u(f,{class:"flex flex-col items-start scroll-mt-[80px]"},{default:x(()=>[(e(!0),l($,null,N(t.value.question.options,h=>(e(),L(a,{class:"rounded hover:bg-gray-100",label:h.label},{default:x(()=>[s("div",ye,[s("span",fe,q(h.label)+".",1),u(I,{class:"scroll-mt-[80px]",content:h.value},null,8,["content"])])]),_:2},1032,["label"]))),256))]),_:1})])])):C("",!0)}}}),he={key:0,class:"ist-theam my-4 p-5 bg-gray-50 rounded-lg border-l-4 border-blue-500 scroll-mt-[80px]",tabindex:"0"},ge={class:"flex flex-col"},Ie={class:"flex items-center nomr"},xe={class:"mr-2"},we=E({__name:"multipleChoice",props:{blockId:Number},setup(v){const r=v,p=i(!1),t=i(),o=i({id:r.blockId,parentId:null,type:"",title:"",content:"",catalogue:"",confData:"",referenceData:"",dataTemplate:"",payload:""}),k=()=>new Promise((b,n)=>{B(r.blockId).then(a=>{a.state==200?(o.value=a.data,o.value.payload!=null&&o.value.payload.length!==0&&(t.value=JSON.parse(o.value.payload)),p.value=!0,b()):(g.error("数据加载失败"),n())})});return D(()=>{setTimeout(async()=>{await k()},500)}),(b,n)=>{const a=z,f=F;return p.value?(e(),l("div",he,[u(I,{content:t.value.question.question},null,8,["content"]),s("div",ge,[u(f,{class:"flex flex-col items-start scroll-mt-[80px]"},{default:x(()=>[(e(!0),l($,null,N(t.value.question.options,h=>(e(),L(a,{class:"rounded hover:bg-gray-100",label:h.label},{default:x(()=>[s("div",Ie,[s("span",xe,q(h.label)+".",1),u(I,{class:"scroll-mt-[80px]",content:h.value},null,8,["content"])])]),_:2},1032,["label"]))),256))]),_:1})])])):C("",!0)}}}),Ce={class:"ist-theam my-4 p-4 bg-gray-50 rounded-lg border-l-4 border-blue-500 scroll-mt-[80px] min-h-[200px] flex flex-row justify-center items-center"},Te=E({__name:"circuit",props:{blockId:Number},setup(v){const r=v,p=i(!1),t=i(),o=i({id:r.blockId,parentId:null,type:"",title:"",content:"",catalogue:"",confData:"",referenceData:"",dataTemplate:"",payload:""}),k=()=>new Promise((b,n)=>{B(r.blockId).then(a=>{a.state==200?(o.value=a.data,o.value.payload!=null&&o.value.payload.length!==0&&(t.value=JSON.parse(o.value.payload)),p.value=!0,b()):(g.error("数据加载失败"),n())})});return D(()=>{setTimeout(async()=>{await k()},500)}),(b,n)=>(e(),l("div",Ce,n[0]||(n[0]=[s("button",{class:"btn bg-blue-500 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-xl shadow-md flex items-center mx-auto"}," 电路检查 ",-1)])))}}),$e={key:0,class:"ist-theam scroll-mt-[80px] my-4 rounded-lg border-l-4 border-blue-500"},Ne={key:0},Ee=["colspan"],De={class:"flex flex-row"},Be={key:0},Re={key:0},Se={key:1},Le=E({__name:"table",props:{blockId:Number},setup(v){const r=v,p=i(!1),t=i(),o=i({id:r.blockId,parentId:null,type:"",title:"",content:"",catalogue:"",confData:"",referenceData:"",dataTemplate:"",payload:""}),k=()=>new Promise((b,n)=>{B(r.blockId).then(a=>{a.state==200?(o.value=a.data,o.value.payload!=null&&o.value.payload.length!==0&&(t.value=JSON.parse(o.value.payload)),p.value=!0,b()):(g.error("数据加载失败"),n())})});return D(()=>{setTimeout(async()=>{await k()},500)}),(b,n)=>{const a=V;return p.value?(e(),l("div",$e,[s("table",null,[s("thead",null,[t.value.table.tableName?(e(),l("tr",Ne,[s("th",{colspan:t.value.table.tableHeader.length},[u(I,{content:t.value.table.tableName},null,8,["content"])],8,Ee)])):C("",!0),s("tr",null,[(e(!0),l($,null,N(t.value.table.tableHeader,(f,h)=>(e(),l("th",null,[s("div",De,[u(I,{content:f.value},null,8,["content"])])]))),256))])]),s("tbody",null,[(e(!0),l($,null,N(t.value.table.tableRow,(f,h)=>(e(),l("tr",null,[(e(!0),l($,null,N(t.value.table.tableRow[h],(T,S)=>(e(),l("td",null,[T.isNeedInput?(e(),l("div",Be,[T.isAutoGet?(e(),l("div",Re,[u(a,{disabled:""},{append:x(()=>n[0]||(n[0]=[s("button",{class:"text-blue-600"},"获取",-1)])),_:1})])):(e(),L(a,{key:1}))])):(e(),l("div",Se,[u(I,{content:T.value},null,8,["content"])]))]))),256))]))),256))])])])):C("",!0)}}}),Oe={class:"ist-theam scroll-mt-[80px] my-4 rounded-lg border-l-4 border-blue-500"},Ve={key:0},qe=["colspan"],Pe={class:"flex flex-row"},Ue={key:0},Ge={key:0},Je={key:1},Ae=E({__name:"tracneline",props:{blockId:Number},setup(v){const r=v,p=i(!1),t=i(),o=i({id:r.blockId,parentId:null,type:"",title:"",content:"",catalogue:"",confData:"",referenceData:"",dataTemplate:"",payload:""}),k=()=>new Promise((b,n)=>{B(r.blockId).then(a=>{a.state==200?(o.value=a.data,o.value.payload!=null&&o.value.payload.length!==0&&(t.value=JSON.parse(o.value.payload)),p.value=!0,b()):(g.error("数据加载失败"),n())})});return D(()=>{setTimeout(async()=>{await k()},500)}),(b,n)=>{const a=V;return e(),l("div",Oe,[s("table",null,[s("thead",null,[t.value.table.tableName?(e(),l("tr",Ve,[s("th",{colspan:t.value.table.tableHeader.length},[u(I,{content:t.value.table.tableName},null,8,["content"])],8,qe)])):C("",!0),s("tr",null,[(e(!0),l($,null,N(t.value.table.tableHeader,(f,h)=>(e(),l("th",null,[s("div",Pe,[u(I,{content:f.value},null,8,["content"])])]))),256))])]),s("tbody",null,[(e(!0),l($,null,N(t.value.table.tableRow,(f,h)=>(e(),l("tr",null,[(e(!0),l($,null,N(t.value.table.tableRow[h],(T,S)=>(e(),l("td",null,[T.isNeedInput?(e(),l("div",Ue,[T.isAutoGet?(e(),l("div",Ge,[u(a,{disabled:""},{append:x(()=>n[0]||(n[0]=[s("button",{class:"text-blue-600"},"获取",-1)])),_:1})])):(e(),L(a,{key:1}))])):(e(),l("div",Je,[u(I,{content:T.value},null,8,["content"])]))]))),256))]))),256))])])])}}});function He(v){return O({url:"elaborate/md/block/create",method:"POST",data:v})}function Me(v){return O({url:"elaborate/md/block/vo/list",method:"GET",params:{sectionId:v}})}const je={class:"section"},Qe={class:"section-edit-parent"},ze={key:0,class:"section-edit"},Fe={class:"section-block-list"},Ke={key:0},Xe={key:1},We={key:2},Ye={key:3},Ze={key:4},et={key:5},tt={key:6},lt={class:"section-block-add-list"},at={key:0},ot={class:"nomr flex flex-row items-center justify-between"},nt={key:1},st={class:"nomr flex flex-row items-center justify-between"},rt=E({__name:"index",setup(v){const r=se(),p=K(),t=i(),o=i(),k=i([]),b=i([]),n=i(!1);i();const a=i(!1),f=m=>{console.log(k.value),b.value=k.value.filter(c=>c.payload.type==m),n.value=!0},h=(m,c)=>{let w=i({sectionId:t.value,sort:null,type:"",payload:""});w.value.type=m,c!=null&&(w.value.payload=JSON.stringify(c)),o.value.length==0?w.value.sort=1:w.value.sort=o.value[o.value.length-1].sort+1,He(w.value).then(R=>{R.state==200?(o.value.push(R.data),T()):g.error(R.message)})},T=()=>{console.log(r.getRouterSectionNode),r.getRouterSectionNode.data.hasChildren?ne(r.getRouterSectionNode.data.id).then(m=>{m.state==200?r.getTreeRef.updateKeyChildren(r.getRouterSectionNode.data.treeId,m.data):g.error(m.message)}):oe(r.getRouterSectionNode.parent.data.id).then(m=>{m.state==200?r.getTreeRef.updateKeyChildren(r.getRouterSectionNode.parent.data.treeId,m.data):g.error(m.message)})};X(()=>r.needUpdatePage,m=>{m&&(S(),r.setNeedUpdatePage(!1))});const S=()=>{Me(t.value).then(m=>{m.state==200&&(a.value=!1,o.value=m.data,a.value=!0)})},G=()=>{r.getCurrentLabId&&re(r.getCurrentLabId).then(m=>{m.state==200?(k.value=[],m.data.forEach(c=>{const w={id:c.id,parentId:c.parentId,payload:JSON.parse(c.payload)};k.value.push(w)})):g.error(m.message)})};return D(()=>{setTimeout(()=>{t.value=p.query.section,S(),G()},10)}),(m,c)=>{const w=W,R=Y,J=Z,A=ee;return e(),l("div",je,[s("div",Qe,[a.value?(e(),l("div",ze,[s("div",Fe,[(e(!0),l($,null,N(o.value,d=>(e(),l("div",{key:d.blockId,class:"section-block-item ist-theam"},[d.type===_(y).TEXT?(e(),l("div",Ke,[u(ie,{"block-id":d.blockId},null,8,["block-id"])])):d.type===_(y).QA?(e(),l("div",Xe,[u(_e,{"block-id":d.blockId},null,8,["block-id"])])):d.type===_(y).TABLE?(e(),l("div",We,[u(Le,{"block-id":d.blockId},null,8,["block-id"])])):d.type===_(y).TRACELINE?(e(),l("div",Ye,[u(Ae,{"block-id":d.blockId},null,8,["block-id"])])):d.type===_(y).CHOICE?(e(),l("div",Ze,[u(ke,{"block-id":d.blockId},null,8,["block-id"])])):d.type===_(y).MULTIPLECHOICE?(e(),l("div",et,[u(we,{"block-id":d.blockId},null,8,["block-id"])])):d.type===_(y).CIRCUIT?(e(),l("div",tt,[u(Te,{"block-id":d.blockId},null,8,["block-id"])])):C("",!0)]))),128))])])):C("",!0),s("div",lt,[s("div",null,q(_(r).getCurrentLabId),1),s("button",{onClick:c[0]||(c[0]=d=>h(_(y).TEXT,null))},"内容"),s("button",{onClick:c[1]||(c[1]=d=>f(_(y).QA))},"问答 "),s("button",{onClick:c[2]||(c[2]=d=>f(_(y).CHOICE))},"单选题"),s("button",{onClick:c[3]||(c[3]=d=>f(_(y).MULTIPLECHOICE))},"多选题"),s("button",{onClick:c[4]||(c[4]=d=>f(_(y).CIRCUIT))},"电路检查"),s("button",{onClick:c[5]||(c[5]=d=>f(_(y).TABLE))},"表格"),s("button",{onClick:c[6]||(c[6]=d=>f(_(y).TRACELINE))},"表格绘图")])]),u(A,{modelValue:n.value,"onUpdate:modelValue":c[7]||(c[7]=d=>n.value=d)},{default:x(()=>[u(J,{data:b.value,style:{width:"100%"}},{default:x(()=>[u(R,{label:"问题组件"},{default:x(d=>[[_(y).CHOICE,_(y).QA,_(y).MULTIPLECHOICE,_(y).CIRCUIT].includes(d.row.payload.type)?(e(),l("div",at,[s("div",ot,[u(I,{content:d.row.payload.question.question},null,8,["content"]),u(w,{type:"primary",onClick:H=>h(d.row.payload.type,d.row.payload)},{default:x(()=>c[8]||(c[8]=[P("添加",-1)])),_:2,__:[8]},1032,["onClick"])])])):C("",!0),[_(y).TABLE,_(y).TRACELINE].includes(d.row.payload.type)?(e(),l("div",nt,[s("div",st,[u(I,{content:d.row.payload.table.tableName},null,8,["content"]),u(w,{type:"primary",onClick:H=>h(d.row.payload.type,d.row.payload)},{default:x(()=>c[9]||(c[9]=[P("添加",-1)])),_:2,__:[9]},1032,["onClick"])])])):C("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}});const It=te(rt,[["__scopeId","data-v-d1f0f223"]]);export{It as default};
