import{d as R,b as i,S as te,m as B,e as oe,a as m,c as C,g as t,w as l,i as b,n as I,F as J,j as H,q as $,t as le,s as _,G as ae,$ as ve,a0 as _e,P as Q,af as W,a2 as ne,a3 as se,a5 as fe,a6 as ge,ad as ye,x as j,y as q,_ as O,f as A,U as xe,as as ue,N as ke,au as re,O as be,E as Ce,aA as Se,aj as he,u as Ie,k as z,r as Te,an as we,ao as $e,v as Ne}from"./index-8f9ccc2f.js";/* empty css                */import{d as Ve,G as Ee,c as Ue,b as De}from"./updateTaskTemplate-f6a23dc4.js";import{A as Ge}from"./index-e553ef04.js";import{b as Le,c as Fe}from"./index-9020ea85.js";import{C as Pe}from"./courseDesign-baa6b6b5.js";import{U as ie,_ as Re}from"./mdExperimentalDesign.vue_vue_type_script_setup_true_lang-64b870ac.js";import{c as Be}from"./getTaskTemplates-4d34e142.js";import{G as qe,a as Me,D as X,b as Y,C as ze,U as Ae}from"./getCourseNode-d7834a6f.js";import{D as Z}from"./deleteVidoeById-b31f1c9d.js";import{G as ee}from"./getRootNodeList-a4187607.js";import{G as je}from"./getCaseVideo-a934e415.js";const Oe={id:"pane-first",class:"pane",key:"0"},Je={class:"cover-upload"},He=["src"],Ke=R({__name:"one",props:{courseId:Number},emits:["nextStep","created"],setup(U,{emit:S}){const T=U,u=i(),a=i(),n=i({id:null,name:"",introduction:"",introduce:"",target:"",cover:"",completion:null,guidance:"",third:1,version:4,deviceId:null,emdv4Course:null}),g=i([]),y=i([]),x=i({"x-access-token":localStorage.getItem("x-access-token"),"x-access-type":localStorage.getItem("x-access-type")}),V=te({name:[{required:!0,message:"请输入课程名称",trigger:"blur"}],introduction:[{required:!0,message:"请输入课程简介",trigger:"blur"}],introduce:[{required:!0,message:"请输入课程详细介绍",trigger:"blur"}],cover:[{required:!0,message:"请上传封面",trigger:"blur"}],emdv4Course:[{required:!0,message:"请选择课程指导书",trigger:"blur"}]}),d=o=>{o.validate((e,s)=>{e?(n.value.id=u.value,Ge(Object.assign({},n.value)).then(k=>{k.state==200?(n.value=k.data,u.value=k.data.id,c(k.data),r(n.value.completion)):_.error(k.message)})):_.error})},f=S,r=o=>{f("nextStep",o)},c=o=>{f("created",o)},p=o=>{o!=null&&ae(o).then(e=>{e.state==200?n.value=e.data:_.error(e.message)})},N=()=>{Le().then(o=>{o.state==200&&(y.value=o.data)})},E=()=>{Fe().then(o=>{o.state==200?g.value=o.data:_.error("获取iecube设备列表异常")})},D=(o,e)=>{o.state==200&&(n.value.cover=o.data.filename)},v=o=>{if(!(o.type=="image/jpeg"||o.type=="image/png"||o.type=="image/gif"))_.error("支持 JPG，PNG， GIF！");else if(o.size/1024/1024>5)return _.error("图片不要大于 2MB!"),!1;return!0};return B(()=>{u.value=T.courseId,p(u.value),N(),E()}),(o,e)=>{const s=ve,k=_e,F=oe("Plus"),P=Q,M=W,G=ne,L=se,w=fe,K=ge,de=ye,ce=j,pe=q;return m(),C("div",Oe,[t(de,{ref_key:"contentFormRef",ref:a,model:n.value,rules:V,"label-width":"120px",class:"contentForm"},{default:l(()=>[t(k,{label:"课程名称",prop:"name"},{default:l(()=>[t(s,{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=h=>n.value.name=h)},null,8,["modelValue"])]),_:1}),t(k,{label:"课程简介",prop:"introduction"},{default:l(()=>[t(s,{type:"textarea",autosize:{minRows:2,maxRows:4},modelValue:n.value.introduction,"onUpdate:modelValue":e[1]||(e[1]=h=>n.value.introduction=h)},null,8,["modelValue"])]),_:1}),t(k,{label:"课程详细介绍",prop:"introduce"},{default:l(()=>[t(s,{type:"textarea",autosize:{minRows:2,maxRows:4},modelValue:n.value.introduce,"onUpdate:modelValue":e[2]||(e[2]=h=>n.value.introduce=h)},null,8,["modelValue"])]),_:1}),t(k,{label:"封面",prop:"cover"},{default:l(()=>[b("div",Je,[t(M,{class:"cover-uploader",action:"/dev-api/files/e/image","show-file-list":!1,headers:x.value,"on-success":D,"before-upload":v},{default:l(()=>[n.value.cover?(m(),C("img",{key:0,src:"/local-resource/image/"+n.value.cover,class:"cover"},null,8,He)):(m(),I(P,{key:1,class:"cover-uploader-icon"},{default:l(()=>[t(F)]),_:1}))]),_:1},8,["headers"])])]),_:1}),t(k,{label:"指导书",prop:"emdv4Course"},{default:l(()=>[t(L,{modelValue:n.value.emdv4Course,"onUpdate:modelValue":e[3]||(e[3]=h=>n.value.emdv4Course=h),placeholder:"选择课程",style:{width:"240px"}},{default:l(()=>[(m(!0),C(J,null,H(y.value,(h,me)=>(m(),I(G,{key:me,label:h.name,value:h.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"实验设备",prop:"deviceId"},{default:l(()=>[t(K,{modelValue:n.value.deviceId,"onUpdate:modelValue":e[4]||(e[4]=h=>n.value.deviceId=h)},{default:l(()=>[t(w,{label:0},{default:l(()=>e[6]||(e[6]=[$("无设备",-1)])),_:1,__:[6]}),(m(!0),C(J,null,H(g.value,h=>(m(),I(w,{label:h.id},{default:l(()=>[$(le(h.name),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t(pe,{class:"bottom-row"},{default:l(()=>[t(ce,{type:"primary",onClick:e[5]||(e[5]=h=>d(a.value))},{default:l(()=>e[7]||(e[7]=[$("下一步",-1)])),_:1,__:[7]})]),_:1})])}}});const Qe=O(Ke,[["__scopeId","data-v-3e6c7103"]]),We={id:"pane-fourth",class:"pane",key:"3"},Xe=R({__name:"two",props:{courseId:Number},emits:["nextStep","lastStep"],setup(U,{emit:S}){const T=U;B(()=>{g.value=T.courseId,x()});const u=S,a=d=>{u("nextStep",d)},n=()=>{u("lastStep")},g=i(0),y=i([]),x=()=>{Pe(g.value).then(d=>{d.state==200?y.value=d.data:_.error("获取课程设计内容异常")})};i(),i({id:null,graduationRequirementName:"",graduationPointList:[],courseTargetList:[]}),te({graduationRequirementName:[{required:!0,message:"请输入毕业要求",trigger:"blur"}],graduationPointList:[{required:!0,validator:function(d,f,r){f[0].point==""?r(new Error("没有对应的毕业要求指标点")):r()},trigger:"change"}],courseTargetList:[{required:!0,validator:function(d,f,r){f[0].point==""?r(new Error("没有对应的课程目标")):r()},trigger:"change"}]}),i(""),i(""),i("");const V=()=>{ie(g.value,1).then(d=>{if(d.state==200){let f=d.data.completion;a(f)}else _.error(d.message)})};return(d,f)=>{const r=j,c=q;return m(),C("div",We,[f[3]||(f[3]=b("div",{style:{margin:"20px 0px"}},[b("span",null," 本节需要明确课程目标和对应知识点的匹配关系(请直接下一步) ")],-1)),t(c,{class:"bottom-row"},{default:l(()=>[t(r,{onClick:n},{default:l(()=>f[1]||(f[1]=[$("上一步",-1)])),_:1,__:[1]}),t(r,{type:"primary",onClick:f[0]||(f[0]=p=>V())},{default:l(()=>f[2]||(f[2]=[$("下一步",-1)])),_:1,__:[2]})]),_:1})])}}});const Ye=O(Xe,[["__scopeId","data-v-1a397317"]]),Ze={id:"pane-fiveth",class:"pane",key:"4"},et={style:{margin:"30px 0px"}},tt={style:{margin:"30px 0px"}},ot={key:0},lt={key:1},at=R({__name:"three",props:{courseId:Number,course:Object},emits:["nextStep","lastStep"],setup(U,{emit:S}){const T=U,u=i(0),a=i(),n=i(0);B(()=>{u.value=T.courseId,a.value=T.course,g(u.value)});const g=v=>{Be(v).then(o=>{o.state==200?(d.value=o.data,d.value.length>0&&(n.value=d.value[d.value.length-1].num)):_.error("获取课程实验列表异常")})},y=S,x=v=>{y("nextStep",v)},V=()=>{y("lastStep")},d=i([]),f=v=>{d.value=v,d.value.length>0&&(n.value=d.value[d.value.length-1].num)},r=()=>{N.value=!1},c=v=>{Ve(u.value,v).then(o=>{o.state==200?d.value=o.data:_.error(o.message)})},p=()=>{d.value.length<1&&_.warning("请完成实验设计"),ie(u.value,2).then(v=>{if(v.state==200){let o=v.data.completion;x(o)}else _.error(v.message)})},N=i(!1),E=i(),D=v=>{console.log(d.value[v]),E.value=JSON.parse(JSON.stringify(d.value[v])),N.value=!0};return(v,o)=>{const e=ke,s=j,k=re,F=be,P=Ce,M=q;return m(),C("div",Ze,[o[5]||(o[5]=b("div",{style:{margin:"30px 0px"}},[b("span",null,"本节需要完善该课程的实验模版")],-1)),b("div",et,[t(F,{data:d.value,border:!0,style:{width:"100%"}},{default:l(()=>[t(e,{prop:"num",label:"实验序号",width:"60px"}),t(e,{prop:"taskName",label:"实验名称"}),t(e,{prop:"labProc.name",label:"实验指导书"}),t(e,{prop:"weighting",label:"实验权重"}),t(e,{prop:"classHour",label:"实验课时"}),t(e,{prop:"",label:"操作",width:"100px"},{default:l(G=>[t(s,{link:"",type:"primary",size:"small",icon:A(xe),onClick:L=>D(G.$index)},null,8,["icon","onClick"]),t(k,{title:"确定删除吗?",onConfirm:L=>c(G.row.id)},{reference:l(()=>[t(s,{link:"",type:"danger",size:"small",icon:A(ue)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),b("div",tt,[t(P,{style:{"min-height":"280px"},shadow:"never"},{header:l(()=>[N.value?(m(),C("div",lt,o[2]||(o[2]=[b("span",null,"编辑实验",-1)]))):(m(),C("div",ot,o[1]||(o[1]=[b("span",null,"添加实验",-1)])))]),default:l(()=>[(m(),I(Re,{key:Date.now().toString(),course:a.value,isEdit:N.value,oldTaskTemplate:E.value,lastTaskNum:n.value,onAddSuccess:f,onExitUpdate:r},null,8,["course","isEdit","oldTaskTemplate","lastTaskNum"]))]),_:1})]),t(M,{class:"bottom-row"},{default:l(()=>[t(s,{onClick:V},{default:l(()=>o[3]||(o[3]=[$("上一步",-1)])),_:1,__:[3]}),t(s,{type:"primary",onClick:o[0]||(o[0]=G=>p())},{default:l(()=>o[4]||(o[4]=[$("下一步",-1)])),_:1,__:[4]})]),_:1})])}}});const nt=O(at,[["__scopeId","data-v-20c161e6"]]),st={key:0},ut={class:"cover-upload"},rt=["src"],it={key:1,style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},dt={key:2,style:{"margin-top":"2em"}},ct=R({__name:"four",props:{course:Object},emits:["nextStep","lastStep"],setup(U,{emit:S}){const T=U,u=i(),a=i(),n=i();i();const g=i([]),y=i({nodeId:null,caseId:u.value}),x=i({"x-access-token":localStorage.getItem("x-access-token"),"x-access-type":localStorage.getItem("x-access-type")}),V=()=>{Me(u.value,a.value.fourthType).then(e=>{e.state!=200&&_.error("更新展示方式出错了")}),a.value.fourthType==="video"&&(a.value.fourth&&X(a.value.fourth),y.value.nodeId=null,N()),a.value.fourthType==="image"&&(n.value&&Z(n.value.id),y.value.nodeId=null),a.value.fourthType==="map"&&(n.value&&Z(n.value.id),a.value.fourth&&X(a.value.fourth),ee().then(e=>{e.state==200&&(g.value=e.data)})),a.value.fourth=null},d=e=>e.type!="image/png"?(_.error("请上传PNG类型的图片"),!1):e.size/1024/1024>2?(_.error("图片最大2MB!"),!1):!0,f=(e,s)=>{e.state==200&&(a.value.fourth=e.data.filename)},r=e=>e.type!="video/mp4"?(_.error("请上传MP4类型的视频"),!1):e.size/1024/1024>2048?(_.error("视频最大2G!"),!1):!0,c=(e,s)=>{e.state==200&&(p.value=e.data)},p=i([]),N=()=>{je(u.value).then(e=>{e.state==200?p.value=e.data:_.error(e.message)})};B(()=>{a.value=T.course,u.value=T.course.id,a.value.fourthType==="video"&&N(),a.value.fourthType==="map"&&(ee().then(e=>{e.state==200&&(g.value=e.data)}),qe(u.value).then(e=>{e.state==200&&(y.value=e.data)}))});const E=S,D=e=>{E("nextStep",e)},v=()=>{E("lastStep")},o=async()=>{if((a.value.fourthType==="video"||a.value.fourthType==="image")&&await Y(u.value,a.value.fourth).then(e=>{if(e.state!=200){_.error(e.message);return}}),a.value.fourthType==="map")if(await Y(u.value,null).then(e=>{if(e.state!=200){_.error(e.message);return}}),y.value.nodeId!=null)await ze(u.value,y.value.nodeId).then(e=>{if(e.state!=200){_.error(e.message);return}});else{_.error("请选择映射图");return}await Ae(u.value,3).then(e=>{if(e.state==200){let s=e.data.completion;D(s)}else _.error(e.message)})};return(e,s)=>{const k=ne,F=se,P=q,M=Q,G=W,L=j;return m(),C("div",null,[t(P,null,{default:l(()=>[t(F,{modelValue:a.value.fourthType,"onUpdate:modelValue":s[0]||(s[0]=w=>a.value.fourthType=w),placeholder:"选择展示方式",style:{width:"240px"},onChange:s[1]||(s[1]=w=>V())},{default:l(()=>[(m(),I(k,{key:"image",label:"图片",value:"image"})),(m(),I(k,{key:"video",label:"视频",value:"video"})),(m(),I(k,{key:"map",label:"映射关系",value:"map"}))]),_:1},8,["modelValue"])]),_:1}),a.value.fourthType==="image"?(m(),C("div",st,[b("div",ut,[t(G,{class:"cover-uploader",action:"/dev-api/files/upimage/",headers:x.value,"show-file-list":!1,"on-success":f,"before-upload":d},{default:l(()=>[a.value.fourth?(m(),C("img",{key:0,src:"/local-resource/image/"+a.value.fourth,class:"cover"},null,8,rt)):(m(),I(M,{key:1,class:"cover-uploader-icon"},{default:l(()=>[t(A(Se))]),_:1}))]),_:1},8,["headers"])])])):a.value.fourthType==="video"?(m(),C("div",it,[t(G,{"file-list":p.value,"onUpdate:fileList":s[2]||(s[2]=w=>p.value=w),class:"upload-demo",headers:x.value,action:"/dev-api/video/n/up/"+u.value,"on-success":c,"before-upload":r},{tip:l(()=>s[7]||(s[7]=[b("div",{class:"el-upload__tip"}," 视频最大1GB ",-1)])),default:l(()=>[t(L,{type:"primary",style:{width:"200px"}},{default:l(()=>s[6]||(s[6]=[$("上传",-1)])),_:1,__:[6]})]),_:1},8,["file-list","headers","action"])])):(m(),C("div",dt,[t(F,{modelValue:y.value.nodeId,"onUpdate:modelValue":s[3]||(s[3]=w=>y.value.nodeId=w),placeholder:"选择映射关系",style:{width:"240px"},onChange:s[4]||(s[4]=w=>V())},{default:l(()=>[(m(!0),C(J,null,H(g.value,(w,K)=>(m(),I(k,{key:"node"+K,label:w.name,value:w.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])),t(P,{class:"bottom-row"},{default:l(()=>[t(L,{onClick:v},{default:l(()=>s[8]||(s[8]=[$("上一步",-1)])),_:1,__:[8]}),t(L,{type:"primary",onClick:s[5]||(s[5]=w=>o())},{default:l(()=>s[9]||(s[9]=[$("下一步",-1)])),_:1,__:[9]})]),_:1})])}}});const pt=O(ct,[["__scopeId","data-v-f7f03a58"]]),mt={id:"pane-seventh",class:"pane",key:"6"},vt={style:{display:"flex","flex-direction":"column"}},_t={style:{padding:"20px"}},ft=R({__name:"five",props:{courseId:Number},emits:["done","lastStep"],setup(U,{emit:S}){const T=U,u=S,a=()=>{u("done")},n=()=>{u("lastStep")},g=i(0);B(()=>{g.value=T.courseId,f(g.value)});const y=i({"x-access-token":localStorage.getItem("x-access-token"),"x-access-type":localStorage.getItem("x-access-type")}),x=i([]),V=c=>c.size/1024/1024/1024>1?(_({showClose:!0,message:"文件最大不能超过1GB",type:"success"}),!1):!0,d=c=>{c.state==200&&(x.value=c.data)},f=async c=>{await Ee(c).then(p=>{p.state==200?x.value=p.data:_.error("获取资源包失败"+p.message)})},r=c=>{Ue(g.value,c).then(p=>{p.state==200?x.value=p.data:_.error(p.message)})};return(c,p)=>{const N=oe("upload-filled"),E=Q,D=W,v=j,o=re,e=q;return m(),C("div",mt,[b("div",vt,[b("div",_t,[t(D,{class:"upload-demo",drag:"",multiple:"",action:"/dev-api/content/upload_pkg/"+g.value,headers:y.value,"before-upload":V,"on-success":d},{tip:l(()=>p[0]||(p[0]=[b("div",{class:"el-upload__tip"}," 单个文件最大不超过100MB。 ",-1)])),default:l(()=>[t(E,{class:"el-icon--upload"},{default:l(()=>[t(N)]),_:1}),p[1]||(p[1]=b("div",{class:"el-upload__text"},[$(" Drop file here or "),b("em",null,"click to upload")],-1))]),_:1,__:[1]},8,["action","headers"])]),b("div",null,[(m(!0),C(J,null,H(x.value.length,s=>(m(),I(e,{style:{"text-align":"left"}},{default:l(()=>[t(v,{type:"primary",icon:A(he),link:""},{default:l(()=>[$(le(x.value[s-1].originFilename),1)]),_:2},1032,["icon"]),t(o,{title:"确定删除吗?",onConfirm:k=>r(x.value[s-1].id)},{reference:l(()=>[t(v,{link:"",type:"danger",size:"small",icon:A(ue)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024))),256))])]),t(e,{class:"bottom-row"},{default:l(()=>[t(v,{onClick:n},{default:l(()=>p[2]||(p[2]=[$("上一步",-1)])),_:1,__:[2]}),t(v,{type:"primary",onClick:a},{default:l(()=>p[3]||(p[3]=[$("完成",-1)])),_:1,__:[3]})]),_:1})])}}});const gt=O(ft,[["__scopeId","data-v-2a614e74"]]),yt={style:{"margin-top":"40px"}},Et=R({__name:"index",setup(U){const S=i({id:null,name:"",introduction:"",introduce:"",target:"",cover:"",completion:null,guidance:"",third:1,deviceId:null,mdCourse:null}),T=Ie(),u=i(0),a=i(0),n=i(0),g=r=>{r>n.value+1||(a.value=r)},y=r=>{a.value=r+1,r>n.value&&(n.value=r)},x=()=>{a.value-=1},V=r=>{console.log(r),u.value=r.id,S.value=r},d=r=>{r&&ae(r).then(c=>{c.state==200?(S.value=c.data,a.value=S.value.completion+1,n.value=S.value.completion):_.error(c.message)})},f=()=>{De(u.value).then(r=>{r.state==200?Te.push({name:T.meta.parentName}):_.error(r.message)})};return B(()=>{u.value=T.params.courseId,d(u.value)}),(r,c)=>{const p=we,N=$e,E=Ne,D=q;return m(),C("div",null,[t(D,null,{default:l(()=>[t(E,{span:24},{default:l(()=>[t(N,{active:a.value,simple:""},{default:l(()=>[t(p,{title:"基本信息",onClick:c[0]||(c[0]=v=>g(0))}),t(p,{title:"课程设计",onClick:c[1]||(c[1]=v=>g(1))}),t(p,{title:"实验设计",onClick:c[2]||(c[2]=v=>g(2))}),t(p,{title:"理实映射",onClick:c[3]||(c[3]=v=>g(3))}),t(p,{title:"附件资源",onClick:c[4]||(c[4]=v=>g(4))})]),_:1},8,["active"])]),_:1})]),_:1}),b("div",yt,[a.value==0?(m(),I(Qe,{key:0,courseId:u.value,onNextStep:y,onCreated:V},null,8,["courseId"])):z("",!0),a.value==1?(m(),I(Ye,{key:1,courseId:u.value,onLastStep:x,onNextStep:y},null,8,["courseId"])):z("",!0),a.value==2?(m(),I(nt,{key:2,courseId:u.value,course:S.value,onLastStep:x,onNextStep:y},null,8,["courseId","course"])):z("",!0),a.value==3?(m(),I(pt,{key:3,course:S.value,onLastStep:x,onNextStep:y},null,8,["course"])):z("",!0),a.value==4?(m(),I(gt,{key:4,courseId:u.value,onLastStep:x,onDone:f},null,8,["courseId"])):z("",!0)])])}}});export{Et as default};
