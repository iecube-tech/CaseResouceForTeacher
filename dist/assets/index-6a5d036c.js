import{h as C,d as ve,u as fe,b as i,S as pe,m as ye,a as s,c as v,i as V,g as t,w as o,F as w,j as D,n as x,q as b,k as j,t as K,f as T,aT as _e,aU as be,U as ge,aA as Ve,as as X,s as q,a2 as ke,a3 as Se,x as ce,y as xe,N as Ce,au as we,O as Te,$ as qe,a0 as Ee,ac as Ue,ad as $e,a8 as Ie}from"./index-8f9ccc2f.js";import{c as Oe}from"./getTaskTemplates-4d34e142.js";function Qe(d){return C({url:"qb/questions",method:"GET",params:{taskTemplateId:d}})}function De(d){return C({url:"qb/add_qs",method:"POST",data:d})}function je(d){return C({url:"qb/update_solution",method:"POST",data:d})}function Fe(d){return C({url:"qb/update_qs",method:"POST",data:d})}function Be(d){return C({url:"qb/del_solution",method:"DELETE",params:{solutionId:d}})}function Ne(d){return C({url:"qb/del_question",method:"DELETE",params:{questionId:d}})}function Le(d){return C({url:"qb/add_solution",method:"POST",data:d})}const Pe={key:0},Re={key:1},Ae={style:{display:"flex","align-items":"center"}},ze={key:0,style:{color:"var(--el-color-primary)"}},Me={key:1},We={style:{"margin-right":"20px",display:"flex","align-items":"center"}},Ge={key:0,type:"warning"},He={class:"dialog-footer"},Je={class:"dialog-footer"},Ke={class:"dialog-footer"},Xe={class:"dialog-footer"},el=ve({__name:"index",setup(d){const Y=fe().params.caseId,E=i(!1),U=i(!1),$=i(!1),I=i(!1),O=i(!1),S=i(void 0),M=()=>{Qe(S.value).then(a=>{a.state==200&&(m.value=a.data)})},F=i([]),m=i([]),B=i(),u=i({id:null,taskTemplateId:S.value,name:"",solve:"",difficulty:null,solutions:[]}),Q=i({id:void 0,questionId:void 0,name:"",isSolution:0}),k=i({id:void 0,questionId:void 0,name:"",isSolution:0}),W=pe({name:[{required:!0,message:"请输入题目",trigger:"blur"}],difficulty:[{required:!0,message:"请选择难度",trigger:"blur"}],solutions:[{required:!0,validator:function(a,e,p){if(e.length>1){let r=0;for(let n=0;n<e.length;n++)e[n].isSolution&&(r+=1);r>0?p():p(new Error("至少保证有一正确选项"))}else p(new Error("至少保证有两选项"))},trigger:"blur"}]}),g=i(null),G=i([{label:"简单",value:1},{label:"一般",value:2},{label:"困难",value:3}]),Z=a=>{console.log(a),g.value=a,U.value=!0},h=a=>{Ne(m.value[a].id).then(e=>{e.state==200?m.value.splice(a,1):q.error(e.message)})},ee=(a,e)=>{console.log(a,e),console.log(),Be(m.value[a].solutions[e].id).then(p=>{p.state==200?m.value[a].solutions.splice(e,1):q.error(p.message)})},le=async a=>{a&&await a.validate((e,p)=>{e&&Fe(g.value).then(r=>{r.state==200?(m.value=r.data,U.value=!1):q.error(r.message)})})},te=()=>{Q.value.name!=""&&(u.value.solutions.push(Object.assign({},Q.value)),Q.value.name="")},oe=()=>{let a={id:void 0,questionId:void 0,name:"对",isSolution:0},e={id:void 0,questionId:void 0,name:"错",isSolution:0};u.value.solutions.push(Object.assign({},a)),u.value.solutions.push(Object.assign({},e))},ae=async a=>{a&&await a.validate((e,p)=>{e&&(u.value.taskTemplateId=S.value,console.log(u.value),De(u.value).then(r=>{r.state==200?(m.value=r.data,u.value.name="",u.value.difficulty=null,u.value.solve="",u.value.solutions=[],E.value=!1):q.error(r.message)}))})},N=i([0,0]),ue=(a,e)=>{N.value[0]=a,N.value[1]=e,k.value=Object.assign({},m.value[a].solutions[e]),$.value=!0},ne=a=>{H.value=a,I.value=!0,f.value.id=null,f.value.questionId=m.value[a].id,f.value.name="",f.value.isSolution=0},f=i({id:void 0,questionId:void 0,name:"",isSolution:0}),H=i(0),se=()=>{let a=Object.assign({},k.value);je(a).then(e=>{e.state==200?(m.value[N.value[0]].solutions[N.value[1]]=a,$.value=!1):q.error(e.message)})},ie=()=>{if(f.value.name=="")return;let a=Object.assign({},f.value);Le(a).then(e=>{e.state==200?(m.value[H.value].solutions.push(a),I.value=!1):q.error(e.message)})},de=a=>{Oe(a).then(e=>{e.state==200&&(F.value=e.data,F.value.length>0&&(S.value=F.value[0].id,M()))})};return ye(()=>{de(Y)}),(a,e)=>{const p=ke,r=Se,n=ce,A=xe,L=Ce,J=we,re=Te,c=qe,y=Ee,z=Ue,P=$e,R=Ie;return s(),v(w,null,[V("div",null,[t(A,{style:{display:"flex","flex-direction":"row","justify-content":"space-between","align-items":"center"}},{default:o(()=>[t(r,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=l=>S.value=l),placeholder:"请选择任务/实验",onChange:M},{default:o(()=>[(s(!0),v(w,null,D(F.value,l=>(s(),x(p,{key:l.id,value:l.id,label:l.num+"："+l.taskName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),V("div",null,[S.value?(s(),x(n,{key:0,link:"",type:"primary",onClick:e[1]||(e[1]=l=>E.value=!0)},{default:o(()=>e[26]||(e[26]=[b("添加题目",-1)])),_:1,__:[26]})):j("",!0),m.value.length>0?(s(),x(n,{key:1,link:"",type:"primary",onClick:e[2]||(e[2]=l=>O.value=!O.value)},{default:o(()=>[O.value==!1?(s(),v("span",Pe,"修改答案")):(s(),v("span",Re,"修改完成"))]),_:1})):j("",!0)])]),_:1}),V("div",null,[t(re,{data:m.value},{default:o(()=>[t(L,{prop:"name",label:"题目"}),t(L,{prop:"solve",label:"解析"}),t(L,{label:"选项"},{default:o(l=>[(s(!0),v(w,null,D(l.row.solutions.length,_=>(s(),v("div",Ae,[l.row.solutions[_-1].isSolution?(s(),v("span",ze,K(l.row.solutions[_-1].name),1)):(s(),v("span",Me,K(l.row.solutions[_-1].name),1)),O.value?(s(),x(n,{key:2,type:"success",icon:T(_e),link:"",style:{"margin-left":"10px"},onClick:me=>ue(l.$index,_-1)},null,8,["icon","onClick"])):j("",!0),O.value?(s(),x(J,{key:3,title:"确定删除该选项？","confirm-button-text":"确认","cancel-button-text":"取消",onConfirm:me=>ee(l.$index,_-1)},{reference:o(()=>[t(n,{type:"danger",icon:T(be),link:""},null,8,["icon"])]),_:2},1032,["onConfirm"])):j("",!0)]))),256))]),_:1}),t(L,{label:"操作",width:"120"},{default:o(l=>[t(n,{type:"primary",link:"",icon:T(ge),onClick:_=>Z(l.row)},null,8,["icon","onClick"]),t(n,{type:"primary",icon:T(Ve),link:"",onClick:_=>ne(l.$index)},null,8,["icon","onClick"]),t(J,{title:"确定删除该题目？","confirm-button-text":"确认","cancel-button-text":"取消",onConfirm:_=>h(l.$index)},{reference:o(()=>[t(n,{type:"danger",link:"",icon:T(X)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])])]),t(R,{modelValue:E.value,"onUpdate:modelValue":e[9]||(e[9]=l=>E.value=l),title:"添加题目"},{footer:o(()=>[V("span",He,[t(n,{onClick:e[7]||(e[7]=l=>E.value=!1)},{default:o(()=>e[29]||(e[29]=[b("取消",-1)])),_:1,__:[29]}),t(n,{type:"primary",onClick:e[8]||(e[8]=l=>ae(B.value))},{default:o(()=>e[30]||(e[30]=[b(" 提交 ",-1)])),_:1,__:[30]})])]),default:o(()=>[t(P,{model:u.value,ref_key:"ruleFormRef",ref:B,rules:W,"label-width":"120px"},{default:o(()=>[t(y,{label:"题目：",prop:"name"},{default:o(()=>[t(c,{modelValue:u.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.name=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),t(y,{label:"难度：",prop:"difficulty"},{default:o(()=>[t(r,{modelValue:u.value.difficulty,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.difficulty=l),placeholder:"选择难度",style:{width:"240px"}},{default:o(()=>[(s(!0),v(w,null,D(G.value,l=>(s(),x(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"题目解析："},{default:o(()=>[t(c,{modelValue:u.value.solve,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.solve=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),t(y,{label:"题目选项：",prop:"solutions"},{default:o(()=>[V("div",null,[(s(!0),v(w,null,D(u.value.solutions.length,l=>(s(),v("div",We,[t(z,{modelValue:u.value.solutions[l-1].isSolution,"onUpdate:modelValue":_=>u.value.solutions[l-1].isSolution=_,label:u.value.solutions[l-1].name},null,8,["modelValue","onUpdate:modelValue","label"]),t(n,{icon:T(X),link:"",type:"danger",onClick:_=>u.value.solutions.splice(l-1,1)},null,8,["icon","onClick"])]))),256)),u.value.solutions.length>0?(s(),v("span",Ge,"Tip：“勾选选项代表该选项为一正确选项”")):j("",!0)])]),_:1}),t(y,{label:"添加选项："},{default:o(()=>[V("div",null,[t(A,{style:{display:"flex","align-items":"center"}},{default:o(()=>[t(c,{modelValue:Q.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>Q.value.name=l),type:"textarea",rows:1,style:{width:"400px","margin-right":"20px"}},null,8,["modelValue"]),t(n,{type:"primary",size:"small",onClick:te},{default:o(()=>e[27]||(e[27]=[b("添加",-1)])),_:1,__:[27]}),t(n,{type:"primary",size:"small",onClick:oe},{default:o(()=>e[28]||(e[28]=[b("添加对/错选项",-1)])),_:1,__:[28]})]),_:1}),t(A,{style:{"margin-top":"20px"}})])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(R,{modelValue:U.value,"onUpdate:modelValue":e[15]||(e[15]=l=>U.value=l),title:"编辑题目"},{footer:o(()=>[V("span",Je,[t(n,{onClick:e[13]||(e[13]=l=>U.value=!1)},{default:o(()=>e[31]||(e[31]=[b("取消",-1)])),_:1,__:[31]}),t(n,{type:"primary",onClick:e[14]||(e[14]=l=>le(B.value))},{default:o(()=>e[32]||(e[32]=[b(" 提交 ",-1)])),_:1,__:[32]})])]),default:o(()=>[t(P,{model:g.value,ref_key:"ruleFormRef",ref:B,rules:W,"label-width":"120px"},{default:o(()=>[t(y,{label:"题目：",prop:"name"},{default:o(()=>[t(c,{modelValue:g.value.name,"onUpdate:modelValue":e[10]||(e[10]=l=>g.value.name=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),t(y,{label:"难度：",prop:"difficulty"},{default:o(()=>[t(r,{modelValue:g.value.difficulty,"onUpdate:modelValue":e[11]||(e[11]=l=>g.value.difficulty=l),placeholder:"选择难度",style:{width:"240px"}},{default:o(()=>[(s(!0),v(w,null,D(G.value,l=>(s(),x(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"题目解析："},{default:o(()=>[t(c,{modelValue:g.value.solve,"onUpdate:modelValue":e[12]||(e[12]=l=>g.value.solve=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(R,{modelValue:$.value,"onUpdate:modelValue":e[20]||(e[20]=l=>$.value=l),title:"编辑选项"},{footer:o(()=>[V("span",Ke,[t(n,{onClick:e[18]||(e[18]=l=>$.value=!1)},{default:o(()=>e[33]||(e[33]=[b("取消",-1)])),_:1,__:[33]}),t(n,{type:"primary",onClick:e[19]||(e[19]=l=>se())},{default:o(()=>e[34]||(e[34]=[b(" 提交 ",-1)])),_:1,__:[34]})])]),default:o(()=>[t(P,{model:k.value,"label-width":"120px"},{default:o(()=>[t(y,{label:"选项："},{default:o(()=>[t(c,{modelValue:k.value.name,"onUpdate:modelValue":e[16]||(e[16]=l=>k.value.name=l),type:"textarea",rows:1},null,8,["modelValue"])]),_:1}),t(y,{label:"是否答案："},{default:o(()=>[t(z,{modelValue:k.value.isSolution,"onUpdate:modelValue":e[17]||(e[17]=l=>k.value.isSolution=l),label:k.value.name},null,8,["modelValue","label"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(R,{modelValue:I.value,"onUpdate:modelValue":e[25]||(e[25]=l=>I.value=l),title:"添加选项"},{footer:o(()=>[V("span",Xe,[t(n,{onClick:e[23]||(e[23]=l=>I.value=!1)},{default:o(()=>e[35]||(e[35]=[b("取消",-1)])),_:1,__:[35]}),t(n,{type:"primary",onClick:e[24]||(e[24]=l=>ie())},{default:o(()=>e[36]||(e[36]=[b(" 提交 ",-1)])),_:1,__:[36]})])]),default:o(()=>[t(P,{model:f.value,"label-width":"120px"},{default:o(()=>[t(y,{label:"选项："},{default:o(()=>[t(c,{modelValue:f.value.name,"onUpdate:modelValue":e[21]||(e[21]=l=>f.value.name=l),type:"textarea",rows:1},null,8,["modelValue"])]),_:1}),t(y,{label:"是否答案："},{default:o(()=>[t(z,{modelValue:f.value.isSolution,"onUpdate:modelValue":e[22]||(e[22]=l=>f.value.isSolution=l),label:f.value.name},null,8,["modelValue","label"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});export{el as default};
