import{d as ne,ag as se,u as re,b as s,m as ie,o as ue,av as de,ai as ce,a as g,c as V,i as m,g as a,w as l,q as _,t as v,n as j,F as M,j as pe,k as me,ak as ve,W as _e,r as y,al as fe,ae as ge,am as be,N as he,an as we,ao as ye,ap as De,O as Ce,aq as Se,y as ke,x as Te,a8 as je,s as xe,ar as Ee,_ as Pe}from"./index-8f9ccc2f.js";/* empty css                *//* empty css                             */import{g as ze}from"./projectStudent-4ff3f16f.js";const Ne={style:{"text-align":"center"}},Ie={style:{"text-align":"center"}},Re={class:"dialog-footer"},Ve=ne({__name:"index",props:{addStudent:Number},setup(Me){const b=se(),p=re(),h=Number(Array.isArray(p.params.projectId)?p.params.projectId[0]:p.params.projectId),D=s(0),x=s(0);s("");const d=s([]),w=s([]),c=s(1),u=s(20),r=s({id:null,projectName:"",createTime:void 0,startTime:void 0,endTime:void 0,mdCourse:null,emdCourse:null}),C=s(!1),B=s([]),L=s([]),A=s([]),Y=()=>{A.value=E.value},E=s([]),H=e=>{E.value=e},O=(e,t,o)=>{const f=o.property;return t[f]===e},U=e=>!d.value.map(t=>t.id).includes(e.id);s(0);const S=e=>_e(e).format("YYYY年MM月DD日 HH:mm"),$=e=>{u.value=e,b.setPageSize(e),c.value=1,w.value=d.value.slice(c.value-1,u.value+c.value-1)},q=e=>{w.value=d.value.slice((c.value-1)*u.value,(c.value-1)*u.value+u.value)};function F(e){console.log(e);let t=1;for(let o=0;o<e.studentTasks.length;o++)e.studentTasks[o].taskStatus==1&&(t=o+1);W(e.id,r.value.id,t,e.studentTasks[t-1].pstid)}const W=async(e,t,o,f)=>{if(console.log(r.value),r.value.mdCourse){await y.push({name:"MdocReadover",params:{projectId:h,pstId:f}});return}if(r.value.emdCourse){const k=y.resolve({name:"EMDReadover",params:{projectId:r.value.id,studentId:e,taskId:t}}).href;window.open(k,"_blank");return}await y.push({name:"ProjectStudentDetail",params:{studentId:e,projectId:h,stepNum:o}})},K=e=>{if(e==0)return"wait";if(e==1)return"process";if(e>=2)return"finish"},X=e=>e?e+"":"-",P=()=>{w.value=d.value.slice((c.value-1)*u.value,(c.value-1)*u.value+u.value),D.value=d.value.length;for(let e=0;e<d.value.length;e++)d.value[e].status>=1&&x.value++},z=()=>{ze(h).then(e=>{e.state==200?(d.value=e.data,b.setData(d.value),P()):xe.error("获取数据异常;"+e.message)})},N=()=>{Ee(h).then(e=>{e.state==200&&(r.value=e.data,console.log(r))})},G=()=>{let e=b.getData();u.value=b.getPageSize(),e!=null?(d.value=e,P()):z(),p.meta.position&&(console.log(p.meta.position),setTimeout(()=>{const t=p.meta.position;t&&window.scrollTo(t.x,t.y)},100)),N()},J=()=>{z(),N()};ie(()=>{p.name==="EMDV4ProejctDetail"&&G()}),ue(()=>{setTimeout(()=>{p.name==="EMDV4ProejctDetail"&&de.on("emdv4ProejctStudentRefesh",J)},200)}),ce((e,t,o)=>{t.meta.savedPosition={x:window.pageXOffset,y:window.pageYOffset},o()});const Q=e=>{localStorage.removeItem("teacherRedover-"+e);const t=y.resolve({path:"/emdv4/task/score/"+e});window.open(t.href,"_blank")};return(e,t)=>{const o=fe,f=ge,k=be,i=he,Z=we,ee=ye,te=De,I=Ce,ae=Se,le=ke,R=Te,oe=je;return g(),V(M,null,[m("div",null,[a(k,{title:r.value.projectName},{default:l(()=>[a(o,{label:"创建时间"},{default:l(()=>[_(v(S(r.value.createTime)),1)]),_:1}),a(o,{label:"开始时间"},{default:l(()=>[_(v(S(r.value.startTime)),1)]),_:1}),a(o,{label:"结束时间"},{default:l(()=>[_(v(S(r.value.endTime)),1)]),_:1}),a(o,{label:"参与人数"},{default:l(()=>[a(f,{size:"small"},{default:l(()=>[_(v(D.value)+"人 ",1)]),_:1})]),_:1}),a(o,{label:"完成人数"},{default:l(()=>[a(f,{size:"small"},{default:l(()=>[_(v(x.value)+"人",1)]),_:1})]),_:1})]),_:1},8,["title"])]),(g(),j(ve,null,[a(I,{data:w.value,"default-sort":{prop:"studentId",order:"descending"},style:{"min-height":"800px"},stripe:"","header-cell-style":{fontWeight:"bold",textAlign:"center"},onRowDblclick:F},{default:l(()=>[a(i,{label:"姓名/学号",width:"110"},{default:l(n=>[m("div",Ne,[m("span",null,v(n.row.stuName),1),t[5]||(t[5]=m("br",null,null,-1)),m("span",null,v(n.row.stuId),1)])]),_:1}),a(i,{label:"任务进度"},{default:l(n=>[a(ee,{"align-center":""},{default:l(()=>[(g(!0),V(M,null,pe(n.row.studentTaskList,(T,Be)=>(g(),j(Z,{title:X(T.score),status:K(T.status),onClick:Le=>Q(T.id)},null,8,["title","status","onClick"]))),256))]),_:2},1024)]),_:1}),a(i,{label:"总分",width:"80"},{default:l(n=>[m("div",Ie,[m("span",null,v(n.row.score),1)])]),_:1}),r.value.emdCourse?me("",!0):(g(),j(i,{key:0,label:"-",width:"50"},{default:l(n=>[a(te,{placement:"left-start",trigger:"hover",content:"下载学生报告"},{reference:l(()=>t[6]||(t[6]=[])),_:1})]),_:1}))]),_:1},8,["data"])],1024)),a(le,{style:{"margin-top":"20px","text-align":"center",display:"flex","justify-content":"center","align-items":"center"}},{default:l(()=>[a(ae,{"current-page":c.value,"onUpdate:currentPage":t[0]||(t[0]=n=>c.value=n),"page-size":u.value,"onUpdate:pageSize":t[1]||(t[1]=n=>u.value=n),"page-sizes":[10,20,40,60],small:!0,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:D.value,onSizeChange:$,onCurrentChange:q},null,8,["current-page","page-size","total"])]),_:1}),a(oe,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=n=>C.value=n),title:"添加学生"},{footer:l(()=>[m("span",Re,[a(R,{onClick:t[2]||(t[2]=n=>C.value=!1)},{default:l(()=>t[7]||(t[7]=[_("取消",-1)])),_:1,__:[7]}),a(R,{type:"primary",onClick:t[3]||(t[3]=n=>Y())},{default:l(()=>t[8]||(t[8]=[_(" 确定 ",-1)])),_:1,__:[8]})])]),default:l(()=>[a(I,{height:"400",data:B.value,ref:"multipleTableRef",onSelectionChange:H},{default:l(()=>[a(i,{type:"selection",selectable:U,width:"40"}),a(i,{type:"index",width:"40"}),a(i,{prop:"studentId",sortable:"",label:"学号"}),a(i,{prop:"studentName",label:"姓名"}),a(i,{prop:"studentClass",label:"班级",filters:L.value,"filter-method":O},null,8,["filters"]),a(i,{prop:"collage",label:"学院"}),a(i,{prop:"major",label:"专业"}),a(i,{prop:"studentGrade",label:"年级"})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const Ue=Pe(Ve,[["__scopeId","data-v-0aa8dc73"]]);export{Ue as default};
