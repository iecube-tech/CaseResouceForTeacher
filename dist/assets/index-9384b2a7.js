import{h as ce,d as pe,ag as ve,u as me,b as u,z as fe,m as _e,ah as ge,ai as he,a as w,c as U,i as p,g as l,w as s,q as m,t as v,n as P,F as q,j as ke,f as H,aj as be,k as we,ak as Te,s as y,W as Se,r as z,al as ye,ae as Ce,am as je,N as De,an as xe,ao as Ee,P as Pe,Q as ze,ap as Ie,O as Ne,aq as Re,y as Ae,x as Be,a8 as Ve,T as Le,ar as Me,_ as Ye}from"./index-8f9ccc2f.js";/* empty css                *//* empty css                             */import{P as Ue}from"./detail-3974838b.js";function qe(C,j){return ce({url:"/project/add_student/"+C,method:"Post",data:j})}const He={style:{"text-align":"center"}},Oe={style:{"text-align":"center"}},$e={class:"dialog-footer"},Fe=pe({__name:"index",props:{addStudent:Number},setup(C){const j=C,T=ve(),g=me(),f=g.params.projectId,D=u(0),I=u(0);u("");const o=u([]),S=u([]),c=u(1),d=u(20),r=u({id:null,projectName:"",createTime:void 0,startTime:void 0,endTime:void 0,mdCourse:null,emdCourse:null});fe(()=>j.addStudent,e=>{e&&(console.log(e),O())});const O=async()=>{await Le().then(e=>{if(e.state==200){k.value=e.data;let t=[];for(let a=0;a<k.value.length;a++)t.includes(k.value[a].studentClass)||t.push(k.value[a].studentClass);for(let a=0;a<t.length;a++)N.value.push({text:t[a],value:t[a]})}else y.error(e.message)}),h.value=!0},h=u(!1),k=u([]),N=u([]),R=u([]),$=()=>{R.value=A.value,qe(f,R.value).then(e=>{e.state==200?(y.success("添加成功"),h.value=!1,L()):y.error(e.message)})},A=u([]),F=e=>{A.value=e},G=(e,t,a)=>{const _=a.property;return t[_]===e},W=e=>!o.value.map(t=>t.id).includes(e.id),K=u(0),x=e=>Se(e).format("YYYY年MM月DD日 HH:mm"),Q=e=>{d.value=e,T.setPageSize(e),c.value=1,S.value=o.value.slice(c.value-1,d.value+c.value-1)},X=e=>{S.value=o.value.slice((c.value-1)*d.value,(c.value-1)*d.value+d.value)};function J(e){console.log(e);let t=1;for(let a=0;a<e.studentTasks.length;a++)e.studentTasks[a].taskStatus==1&&(t=a+1);B(e.id,r.value.id,t,e.studentTasks[t-1].pstid)}const B=async(e,t,a,_)=>{if(console.log(r.value),r.value.mdCourse){await z.push({name:"MdocReadover",params:{projectId:f,pstId:_}});return}if(r.value.emdCourse){const E=z.resolve({name:"EMDReadover",params:{projectId:r.value.id,studentId:e,taskId:t}}).href;window.open(E,"_blank");return}await z.push({name:"ProjectStudentDetail",params:{studentId:e,projectId:f,stepNum:a}})},Z=e=>{if(e==0)return"wait";if(e==1)return"process";if(e>=2)return"finish"},ee=e=>e?e+"":"-",V=()=>{S.value=o.value.slice((c.value-1)*d.value,(c.value-1)*d.value+d.value),D.value=o.value.length;for(let e=0;e<o.value.length;e++){let t=0;for(let a=0;a<o.value[e].studentTasks.length;a++)o.value[e].studentTasks[a].taskStatus==1,o.value[e].studentTasks[a].taskStatus>=2&&t++;t==o.value[e].studentTasks.length&&I.value++}K.value=1},L=()=>{Ue(f).then(e=>{e.state==200?(o.value=e.data,console.log(o.value),console.log(o.value.map(t=>t.id)),T.setData(o.value),V()):y.error("获取数据异常;"+e.message)})},te=()=>{Me(f).then(e=>{e.state==200&&(r.value=e.data,console.log(r))})},ae=()=>{let e=T.getData();d.value=T.getPageSize(),e!=null?(o.value=e,V()):L(),g.meta.position&&(console.log(g.meta.position),setTimeout(()=>{const t=g.meta.position;t&&window.scrollTo(t.x,t.y)},100)),te()};return _e(()=>{g.name==="ProjectDetail"&&ae()}),ge(()=>{}),he((e,t,a)=>{t.meta.savedPosition={x:window.pageXOffset,y:window.pageYOffset},a()}),(e,t)=>{const a=ye,_=Ce,E=je,i=De,le=xe,se=Ee,ne=Pe,oe=ze,ue=Ie,M=Ne,re=Re,ie=Ae,Y=Be,de=Ve;return w(),U(q,null,[p("div",null,[l(E,{title:r.value.projectName},{default:s(()=>[l(a,{label:"创建时间"},{default:s(()=>[m(v(x(r.value.createTime)),1)]),_:1}),l(a,{label:"开始时间"},{default:s(()=>[m(v(x(r.value.startTime)),1)]),_:1}),l(a,{label:"结束时间"},{default:s(()=>[m(v(x(r.value.endTime)),1)]),_:1}),l(a,{label:"参与人数"},{default:s(()=>[l(_,{size:"small"},{default:s(()=>[m(v(D.value)+"人",1)]),_:1})]),_:1}),l(a,{label:"完成人数"},{default:s(()=>[l(_,{size:"small"},{default:s(()=>[m(v(I.value)+"人",1)]),_:1})]),_:1})]),_:1},8,["title"])]),(w(),P(Te,null,[l(M,{data:S.value,"default-sort":{prop:"studentId",order:"descending"},style:{"min-height":"800px"},stripe:"","header-cell-style":{fontWeight:"bold",textAlign:"center"},onRowDblclick:J},{default:s(()=>[l(i,{label:"姓名/学号",width:"110"},{default:s(n=>[p("div",He,[p("span",null,v(n.row.studentName),1),t[5]||(t[5]=p("br",null,null,-1)),p("span",null,v(n.row.studentId),1)])]),_:1}),l(i,{label:"任务进度"},{default:s(n=>[l(se,{"align-center":""},{default:s(()=>[(w(!0),U(q,null,ke(n.row.studentTasks.length,b=>(w(),P(le,{title:ee(n.row.studentTasks[b-1].taskGrade),status:Z(n.row.studentTasks[b-1].taskStatus),onClick:Ge=>B(n.row.id,n.row.studentTasks[b-1].taskId,b,n.row.studentTasks[b-1].pstid)},null,8,["title","status","onClick"]))),256))]),_:2},1024)]),_:1}),l(i,{label:"总分",width:"80"},{default:s(n=>[p("div",Oe,[p("span",null,v(n.row.studentGrade),1)])]),_:1}),r.value.emdCourse?we("",!0):(w(),P(i,{key:0,label:"-",width:"50"},{default:s(n=>[l(ue,{placement:"left-start",trigger:"hover",content:"下载学生报告"},{reference:s(()=>[l(oe,{type:"primary",underline:!1,href:"/dev-api/project/student_report?projectId="+H(f)+"&studentId="+n.row.id},{default:s(()=>[l(ne,{size:18},{default:s(()=>[l(H(be))]),_:1})]),_:2},1032,["href"])]),_:2},1024)]),_:1}))]),_:1},8,["data"])],1024)),l(ie,{style:{"margin-top":"20px","text-align":"center",display:"flex","justify-content":"center","align-items":"center"}},{default:s(()=>[l(re,{"current-page":c.value,"onUpdate:currentPage":t[0]||(t[0]=n=>c.value=n),"page-size":d.value,"onUpdate:pageSize":t[1]||(t[1]=n=>d.value=n),"page-sizes":[10,20,40,60],small:!0,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:D.value,onSizeChange:Q,onCurrentChange:X},null,8,["current-page","page-size","total"])]),_:1}),l(de,{modelValue:h.value,"onUpdate:modelValue":t[4]||(t[4]=n=>h.value=n),title:"添加学生"},{footer:s(()=>[p("span",$e,[l(Y,{onClick:t[2]||(t[2]=n=>h.value=!1)},{default:s(()=>t[6]||(t[6]=[m("取消",-1)])),_:1,__:[6]}),l(Y,{type:"primary",onClick:t[3]||(t[3]=n=>$())},{default:s(()=>t[7]||(t[7]=[m(" 确定 ",-1)])),_:1,__:[7]})])]),default:s(()=>[l(M,{height:"400",data:k.value,ref:"multipleTableRef",onSelectionChange:F},{default:s(()=>[l(i,{type:"selection",selectable:W,width:"40"}),l(i,{type:"index",width:"40"}),l(i,{prop:"studentId",sortable:"",label:"学号"}),l(i,{prop:"studentName",label:"姓名"}),l(i,{prop:"studentClass",label:"班级",filters:N.value,"filter-method":G},null,8,["filters"]),l(i,{prop:"collage",label:"学院"}),l(i,{prop:"major",label:"专业"}),l(i,{prop:"studentGrade",label:"年级"})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const Je=Ye(Fe,[["__scopeId","data-v-59a03d14"]]);export{Je as default};
