import{h as f,d as W,u as X,b as c,S as B,m as Y,a as m,c as y,i as v,g as l,w as s,q as _,f as T,U as Z,V as ee,as as te,n as V,F as N,j as G,k as ae,t as le,at as oe,s as u,N as se,x as ne,au as ue,O as re,a2 as de,a3 as ie,a0 as ce,$ as me,a5 as ge,a6 as pe,ad as _e,a8 as fe,_ as be}from"./index-8f9ccc2f.js";function ke(n){return f({url:"/tags/teacher_project_tags",method:"GET",params:{projectId:n}})}function je(n){return f({url:"/tags/add_tag",method:"POST",data:n})}function ye(n){return f({url:"/tags/modify_tag",method:"POST",data:n})}function ve(n){return f({url:"/tags/delete_tag",method:"GET",params:{id:n}})}function Te(n){return f({url:"/task/project_tasks",method:"GET",params:{projectId:n}})}const Ve={class:"dialog-footer"},Ne=W({__name:"index",setup(n){const b=X(),d=b.params.projectId;b.params.studentId,b.params.stepNum;const i=c(!1),P=c([]),g=c(!1),E=c([]),x=c([]),I=c(),e=B({id:null,taskNum:null,name:"",suggestion:"",projectId:d,suggestionProject:null}),M=B({taskNum:[{required:!0,message:"请选择任务",trigger:"blur"}],name:[{required:!0,message:"请输入tag名称",trigger:"blur"}]}),w=a=>{a.id!=null&&(e.id=a.id,e.name=a.name,e.suggestion=a.suggestion,e.projectId=a.projectId,e.taskNum=a.taskNum,e.suggestionProject=a.suggestionProject,g.value=!0),i.value=!0},O=()=>{i.value=!1,g.value=!1,e.id=null,e.name="",e.taskNum="",e.suggestion="",e.projectId=d,e.suggestionProject=null},R=()=>{oe().then(a=>{a.state==200?x.value=a.data:u.error("获取数据异常;"+a.message)})},U=async a=>{a&&await a.validate((t,r)=>{t?g.value==!0?(S(),g.value=!1):D():console.log("error submit!",r)})},S=async()=>{const a=Object.assign({},e);await ye(a).then(t=>{t.state==200?(u({message:"修改成功",type:"success"}),k(),e.id=null,e.name="",e.taskNum="",e.suggestion="",e.projectId=d,e.suggestionProject=null,i.value=!1):u.error("修改失败："+t.data)})},D=async()=>{const a=Object.assign({},e);await je(a).then(t=>{t.state==200?(u({message:"添加成功",type:"success"}),k(),e.id=null,e.name="",e.taskNum="",e.suggestion="",e.projectId=d,e.suggestionProject=null,i.value=!1):u.error("添加失败："+t.data)})},F=async a=>{await ve(a.id).then(t=>{t.state==200?(u({message:"删除成功",type:"success"}),k()):u.error("删除失败："+t.data)})},k=async()=>{await ke(d).then(a=>{a.state==200?P.value=a.data:u.error("获取数据失败："+a.message)})},$=()=>{Te(d).then(a=>{a.state==200?E.value=a.data:u.error("获取数据异常")})};return Y(()=>{R(),b.params.projectId&&($(),k())}),(a,t)=>{const r=se,p=ne,q=ue,L=re,z=de,A=ie,j=ce,h=me,C=ge,H=pe,J=_e,K=fe;return m(),y(N,null,[v("div",null,[l(L,{data:P.value,border:!0,"row-style":{flexGrow:1}},{default:s(()=>[l(r,{type:"index",label:"序号",width:"80"}),l(r,{prop:"taskName",label:"任务名称",width:"180"}),l(r,{prop:"name",label:"tag名称",width:"200"}),l(r,{prop:"suggestion",label:"改进建议"}),l(r,{align:"center",width:"180"},{header:s(()=>[l(p,{type:"primary",link:"",onClick:w},{default:s(()=>t[6]||(t[6]=[_("添加Tag",-1)])),_:1,__:[6]})]),default:s(o=>[l(p,{type:"primary",link:"",icon:T(Z),onClick:Q=>w(o.row)},null,8,["icon","onClick"]),l(q,{width:"220","confirm-button-text":"确定","cancel-button-text":"取消",icon:T(ee),"icon-color":"#33b8b9",title:"确定删除该条目吗?",onConfirm:Q=>F(o.row)},{reference:s(()=>[l(p,{size:"small",type:"danger",icon:T(te),link:""},null,8,["icon"])]),_:2},1032,["icon","onConfirm"])]),_:1})]),_:1},8,["data"])]),l(K,{modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=o=>i.value=o),title:"编辑",width:"70%"},{footer:s(()=>[v("span",Ve,[l(p,{onClick:O},{default:s(()=>t[8]||(t[8]=[_("取消",-1)])),_:1,__:[8]}),l(p,{type:"primary",onClick:t[4]||(t[4]=o=>U(I.value))},{default:s(()=>t[9]||(t[9]=[_(" 保存 ",-1)])),_:1,__:[9]})])]),default:s(()=>[v("div",null,[l(J,{ref_key:"formRef",ref:I,"status-icon":"",model:e,rules:M,"label-width":"120px"},{default:s(()=>[g.value==!1?(m(),V(j,{key:0,label:"任务名称",prop:"taskNum"},{default:s(()=>[l(A,{modelValue:e.taskNum,"onUpdate:modelValue":t[0]||(t[0]=o=>e.taskNum=o),placeholder:"请选择任务"},{default:s(()=>[(m(!0),y(N,null,G(E.value,o=>(m(),V(z,{key:o.num,label:o.taskName,value:o.num},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):ae("",!0),l(j,{label:"Tag名称",prop:"name"},{default:s(()=>[l(h,{placeholder:"请输入名称",modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=o=>e.name=o)},null,8,["modelValue"])]),_:1}),l(j,{label:"改进建议"},{default:s(()=>[l(h,{placeholder:"改进建议",modelValue:e.suggestion,"onUpdate:modelValue":t[2]||(t[2]=o=>e.suggestion=o)},null,8,["modelValue"])]),_:1}),l(j,{label:"推荐学习"},{default:s(()=>[l(H,{modelValue:e.suggestionProject,"onUpdate:modelValue":t[3]||(t[3]=o=>e.suggestionProject=o)},{default:s(()=>[l(C,{label:null},{default:s(()=>t[7]||(t[7]=[_("无",-1)])),_:1,__:[7]}),(m(!0),y(N,null,G(x.value,o=>(m(),V(C,{label:o.id},{default:s(()=>[_(le(o.projectName),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])],64)}}});const Ee=be(Ne,[["__scopeId","data-v-d0c40907"]]);export{Ee as default};
