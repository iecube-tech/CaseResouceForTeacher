import{h as F,d as se,u as de,b as s,m as re,S as ce,o as ve,D as fe,a as v,c as E,i as f,g as n,w as a,t as pe,n as C,f as H,aA as me,k as P,U as _e,as as he,q as J,F as N,j as O,s as T,L as ye,x as be,bh as ge,$ as Se,a0 as ze,a2 as ke,a3 as Ve,y as xe,bu as we,ad as Ee,a8 as Ce,_ as Ne}from"./index-8f9ccc2f.js";function Te(m){return F({url:"/map/mapping/root/"+m,method:"GET"})}function Ue(m,g){return F({url:"/map/add_node/"+g,method:"POST",data:m})}function Ie(m,g){return F({url:"/map/up_node/"+g,method:"POST",data:m})}function Oe(m,g){return F({url:"/map/del_node/"+g+"/"+m,method:"DELETE"})}const Fe={class:"mapping"},Ae={class:"mapping_tree"},Be={class:"custom-tree-node"},He={style:{overflow:"hidden"}},Le={class:"dialog-footer"},Me=se({__name:"index",setup(m){const g=de(),k=s();re(()=>{c.value=null});const q=l=>{Te(l).then(e=>{e.state==200?c.value=e.data:T.error(e.message)})},V=s(!1),L=s(),i=s(),G=ce({name:[{required:!0,message:"请输入名称",trigger:"blur"}]}),j=[{id:1,label:"外部链接"},{id:2,label:"实验指导书"}],A=s(1),W=s([]),M=[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40],K=s(["#343838","#005f6b","#008c9e","#00dffc","#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"]),Q=l=>{l&&l.validate((e,t)=>{e?Ie(JSON.parse(JSON.stringify(i.value)),k.value).then(p=>{p.state==200?(V.value=!1,c.value=p.data,B()):T.error(p.message)}):T.error})},X=()=>{i.value={id:null,level:null,name:"",pid:null,itemStyle:{color:"#00dffc"},label:{position:"right",color:"inherit",fontSize:14},symbolSize:10,link:""}},Y=l=>{Ue(l,k.value).then(e=>{e.state==200?(c.value=e.data,B()):T.error(e.message)})},Z=l=>{Oe(l,k.value).then(e=>{e.state==200?(c.value=e.data,B()):T.error(e.message)})},ee={children:"children",label:"name"},_=s({color:"#005f6b",position:"left",fontSize:24,symbolSize:24}),h=s({color:"#008c9e",position:"left",fontSize:20,symbolSize:15}),y=s({color:"#00dffc",position:"right",fontSize:14,symbolSize:10}),le=l=>{l.children||(l.children=[]);const e={id:null,level:1,name:"新建节点",pid:null,itemStyle:{color:"#00dffc"},label:{position:"right",color:"inherit",fontSize:14},symbolSize:10,link:"",children:[]};if(e.level=l.level+1,e.pid=l.id,l.level==1)e.itemStyle.color=_.value.color,e.label.position=_.value.position,e.label.fontSize=_.value.fontSize,e.symbolSize=_.value.symbolSize;else if(l.level==2)e.itemStyle.color=h.value.color,e.label.position=h.value.position,e.label.fontSize=h.value.fontSize,e.symbolSize=h.value.symbolSize;else if(l.level==3)e.itemStyle.color=y.value.color,e.label.position=y.value.position,e.label.fontSize=y.value.fontSize,e.symbolSize=y.value.symbolSize;else return;Y(JSON.parse(JSON.stringify(e)))},oe=(l,e)=>{i.value=e,V.value=!0},te=(l,e)=>{Z(e.id)},c=s([]),u=s(),U=s({tooltip:{trigger:"item",triggerOn:"mousemove"},series:[{type:"tree",name:"tree",data:[],top:"5%",left:"10%",bottom:"5%",right:"10%",roam:"move",symbolSize:10,symbol:"emptyCircle",itemStyle:{color:"#89c7c7"},leaves:{label:{position:"right"}},emphasis:{focus:"relative"},initialTreeDepth:3,animationDuration:550,animationDurationUpdate:750,layout:"orthogonal",orient:"LR"}]}),x=s(900);s(0);function I(l,e){return Array.isArray(l)?l.forEach(t=>{t.children&&t.children.length>0?I(t.children,e):e.push(t)}):l.children&&l.children.length>0?I(l.children,e):e.push(l),e}function R(l){const e=[];return l.forEach(t=>{e.push(t),t.children.length>0&&e.push.apply(e,R(t.children))}),e}const ne=()=>{$();const l=I(c.value,[]),e=40,t=e*(l.length-1)||e,p=Math.max(t,e,x.value);x.value=p,u.value=ye(document.getElementById("tree_chart")),u.value.showLoading(),U.value.series[0].data=c.value,u.value.setOption(U.value),u.value.hideLoading(),u.value.on("mousedown",function(d){const S=d.data.name,z=d.dataIndex;console.log(z),u.value._chartsViews[0]._data.tree._nodes.filter(function(b){return b.name===S})[0].depth&&u.value._chartsViews[0]._data.tree._nodes.forEach(function(b){d.event.target.culling===!1&&b.dataIndex===z&&(b.isExpand=!b.isExpand)})}),u.value.on("click",function(d){d.event.target.culling===!1&&d.data.link&&d.data.link!=""&&d.data.link.startsWith("http",0)&&window.open(d.data.link)}),window.addEventListener("resize",function(){u.value&&u.value.resize()})},B=()=>{if(u.value!=null){const e=I(c.value,[]),t=40,p=t*(e.length-1)||t,d=Math.max(p,t,x.value);x.value=d,u.value.resize({height:x.value+"px"}),U.value.series[0].data=c.value,u.value.setOption(U.value)}const l=R(c.value);console.log(l),l.forEach(e=>{e.level===2&&(_.value.color=e.itemStyle.color,_.value.position=e.label.position,_.value.fontSize=e.label.fontSize,_.value.symbolSize=e.symbolSize),e.level===3&&(h.value.color=e.itemStyle.color,h.value.position=e.label.position,h.value.fontSize=e.label.fontSize,h.value.symbolSize=e.symbolSize),e.level===4&&(y.value.color=e.itemStyle.color,y.value.position=e.label.position,y.value.fontSize=e.label.fontSize,y.value.symbolSize=e.symbolSize)})},$=()=>{u.value!=null&&(u.value.dispose(),u.value=null)};return ve(()=>{setTimeout(()=>{k.value=g.params.id,q(k.value)},200),setTimeout(()=>{ne()},1500)}),fe(()=>{$()}),(l,e)=>{const t=be,p=ge,d=Se,S=ze,z=ke,w=Ve,b=xe,ae=we,ie=Ee,ue=Ce;return v(),E(N,null,[f("div",Fe,[f("div",Ae,[n(p,{style:{"max-width":"100%"},data:c.value,draggable:"","default-expand-all":"","node-key":"id",props:ee,"expand-on-click-node":!1},{default:a(({node:o,data:r})=>[f("div",Be,[f("div",He,[f("span",null,pe(o.label),1)]),f("div",null,[f("span",null,[r.level<4?(v(),C(t,{key:0,link:"",icon:H(me),onClick:D=>le(r)},null,8,["icon","onClick"])):P("",!0),n(t,{link:"",icon:H(_e),onClick:D=>oe(o,r)},null,8,["icon","onClick"]),r.level>1?(v(),C(t,{key:1,link:"",icon:H(he),onClick:D=>te(o,r)},null,8,["icon","onClick"])):P("",!0)])])])]),_:1},8,["data"])]),e[10]||(e[10]=f("div",{class:"echart_container",id:"tree_chart"},null,-1))]),n(ue,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=o=>V.value=o),title:"节点信息",width:"700",onClosed:X},{footer:a(()=>[f("div",Le,[n(t,{onClick:e[7]||(e[7]=o=>V.value=!1)},{default:a(()=>e[11]||(e[11]=[J("取消",-1)])),_:1,__:[11]}),n(t,{type:"primary",onClick:e[8]||(e[8]=o=>Q(L.value))},{default:a(()=>e[12]||(e[12]=[J(" 更新 ",-1)])),_:1,__:[12]})])]),default:a(()=>[n(ie,{model:i.value,"label-width":"120px",rules:G,ref_key:"updateFormRef",ref:L},{default:a(()=>[n(S,{label:"名称：",prop:"name"},{default:a(()=>[n(d,{modelValue:i.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.name=o),style:{width:"500px"}},null,8,["modelValue"])]),_:1}),n(S,{label:"跳转链接："},{default:a(()=>[f("div",null,[n(b,null,{default:a(()=>[n(w,{modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=o=>A.value=o),style:{width:"320px"}},{default:a(()=>[(v(),E(N,null,O(j,(o,r)=>n(z,{key:r,label:o.label,value:o.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(b,{style:{"margin-top":"20px"}},{default:a(()=>[A.value==1?(v(),C(d,{key:0,modelValue:i.value.link,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.link=o),style:{width:"500px"}},null,8,["modelValue"])):(v(),C(w,{key:1,modelValue:i.value.link,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.link=o),placeholder:"选择指导书",style:{width:"320px"}},{default:a(()=>[(v(!0),E(N,null,O(W.value,(o,r)=>(v(),C(z,{key:r,label:o.name,value:"#"+o.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1})])]),_:1}),n(S,{label:"节点大小："},{default:a(()=>[n(w,{modelValue:i.value.symbolSize,"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.symbolSize=o),style:{width:"120px"}},{default:a(()=>[(v(),E(N,null,O(M,(o,r)=>n(z,{key:r,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(S,{label:"字体大小："},{default:a(()=>[n(w,{modelValue:i.value.label.fontSize,"onUpdate:modelValue":e[5]||(e[5]=o=>i.value.label.fontSize=o),style:{width:"120px"}},{default:a(()=>[(v(),E(N,null,O(M,(o,r)=>n(z,{key:r,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(S,{label:"颜色："},{default:a(()=>[n(ae,{modelValue:i.value.itemStyle.color,"onUpdate:modelValue":e[6]||(e[6]=o=>i.value.itemStyle.color=o),"show-alpha":"",predefine:K.value},null,8,["modelValue","predefine"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}});const $e=Ne(Me,[["__scopeId","data-v-ddf09c48"]]);export{$e as default};
