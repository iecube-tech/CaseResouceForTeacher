import{h,d as j,u as q,b as m,m as H,a as b,c as A,i as T,F as S,j as J,n as K,w as l,q as p,t as G,k as U,g as a,f,as as Q,s as r,ae as W,N as X,x as Y,au as Z,O as ee,a8 as te}from"./index-8f9ccc2f.js";import{u as ae}from"./userGroupStore-011673ee.js";function le(s){return h({url:"user/group/"+s,method:"GET"})}function oe(){return h({url:"auth/all",method:"GET"})}function ne(s,d){return h({url:"user/group/"+s+"/remove/auth/"+d,method:"DELETE"})}function ue(s,d){return h({url:"user/group/"+s+"/remove/teacher/"+d,method:"DELETE"})}function re(s,d){return h({url:"user/group/"+s+"/add/auth",method:"POST",data:d})}function se(s,d){return h({url:"user/group/"+s+"/add/teacher",method:"POST",data:d})}function ie(){return h({url:"/teacher/teacher_list",method:"GET"})}const de={style:{display:"flex","flex-direction":"column",width:"100%"}},me={key:0},pe={key:1},he=j({__name:"index",setup(s){const d=q(),i=ae(),c=m(),u=m(),k=m(),V=m(),_=m(!1),y=m(),N=t=>{y.value=t,_.value=!0},w=t=>{ne(c.value,t.id).then(e=>{e.state==200?(u.value=e.data,_.value=!1):r.error(e.message)})},x=t=>{ue(c.value,t).then(e=>{e.state==200?u.value=e.data:r.error(e.message)})},L=t=>!u.value.authorities.map(e=>e.id).includes(t.id),g=m([]),R=t=>{g.value=t},$=t=>!u.value.teacherList.map(e=>e.teacherId).includes(t.teacherId),C=m([]),B=t=>{C.value=t},I=()=>{if(console.log(g.value),console.log(g.value.map(t=>t.id)),g.value==null){r.warning("未选择添加的对象");return}if(g.value.length<1){r.warning("未选择添加的对象"),i.addAuthDialogChange();return}re(c.value,g.value.map(t=>t.id)).then(t=>{t.state==200?(u.value=t.data,i.addAuthDialogChange(),g.value=[]):r.error(t.message)})},O=()=>{if(C.value==null){r.warning("未选择添加的对象");return}if(C.value.length<1){r.warning("未选择添加的对象"),i.addUserDialogChange();return}se(c.value,C.value.map(t=>t.teacherId)).then(t=>{t.state==200?(u.value=t.data,i.addUserDialogChange(),C.value=[]):r.error(t.message)})},P=()=>{c.value=d.params.id,le(c.value).then(t=>{t.state==200?u.value=t.data:r.error(t.message)}),oe().then(t=>{t.state==200?k.value=t.data:r.error(t.message)}),ie().then(t=>{t.state==200?V.value=t.data:r.error(t.message)})};return H(()=>{setTimeout(()=>{P()},50)}),(t,e)=>{const z=W,n=X,v=Y,F=Z,E=ee,D=te;return b(),A(S,null,[T("div",de,[e[8]||(e[8]=T("div",{style:{"font-size":"1.5em"}}," 用户组权限 ",-1)),u.value!=null?(b(),A("div",me,[(b(!0),A(S,null,J(u.value.authorities,(o,M)=>(b(),K(z,{key:o.authority,closable:"",onClose:ge=>N(o),style:{"margin-right":"1em","margin-top":"1em"}},{default:l(()=>[p(G(o.instructions),1)]),_:2},1032,["onClose"]))),128))])):U("",!0),e[9]||(e[9]=T("div",{style:{"font-size":"1.5em","margin-top":"2em"}}," 用户列表 ",-1)),u.value!=null?(b(),A("div",pe,[a(E,{data:u.value.teacherList},{default:l(()=>[a(n,{prop:"schoolName",label:"学校"}),a(n,{prop:"collageName",label:"学院"}),a(n,{prop:"teacherEmail",label:"账户"}),a(n,{prop:"teacherName",label:"用户名"}),a(n,{label:"操作",align:"right"},{default:l(o=>[a(F,{title:"确定要将用户移出用户组吗?",onConfirm:M=>x(o.row.teacherId)},{reference:l(()=>[a(v,{link:"",type:"danger",icon:f(Q)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])])):U("",!0)]),a(D,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=o=>_.value=o),title:"确定移除权限吗",width:"500",onClose:e[3]||(e[3]=o=>y.value=null)},{footer:l(()=>[a(v,{onClick:e[0]||(e[0]=o=>_.value=!1)},{default:l(()=>e[10]||(e[10]=[p("取消",-1)])),_:1,__:[10]}),a(v,{type:"primary",onClick:e[1]||(e[1]=o=>w(y.value))},{default:l(()=>e[11]||(e[11]=[p("确定",-1)])),_:1,__:[11]})]),default:l(()=>[p(" 正在删除权限：“"+G(y.value.instructions)+"”， 确定删除吗 ",1)]),_:1},8,["modelValue"]),a(D,{modelValue:f(i).addAuthDialog,"onUpdate:modelValue":e[5]||(e[5]=o=>f(i).addAuthDialog=o),title:"用户组权限"},{footer:l(()=>[a(v,{onClick:e[4]||(e[4]=o=>f(i).addAuthDialogChange())},{default:l(()=>e[12]||(e[12]=[p("取消",-1)])),_:1,__:[12]}),a(v,{type:"primary",onClick:I},{default:l(()=>e[13]||(e[13]=[p("添加",-1)])),_:1,__:[13]})]),default:l(()=>[a(E,{data:k.value,onSelectionChange:R},{default:l(()=>[a(n,{prop:"instructions"}),a(n,{type:"selection",selectable:L,align:"right"})]),_:1},8,["data"])]),_:1},8,["modelValue"]),a(D,{modelValue:f(i).addUserDialog,"onUpdate:modelValue":e[7]||(e[7]=o=>f(i).addUserDialog=o),title:"添加用户"},{footer:l(()=>[a(v,{onClick:e[6]||(e[6]=o=>f(i).addUserDialogChange())},{default:l(()=>e[14]||(e[14]=[p("取消",-1)])),_:1,__:[14]}),a(v,{type:"primary",onClick:O},{default:l(()=>e[15]||(e[15]=[p("添加",-1)])),_:1,__:[15]})]),default:l(()=>[a(E,{data:V.value,onSelectionChange:B},{default:l(()=>[a(n,{prop:"schoolName",label:"学校"}),a(n,{prop:"collageName",label:"学院"}),a(n,{prop:"teacherEmail",label:"账号"}),a(n,{prop:"teacherName",label:"姓名"}),a(n,{type:"selection",selectable:$,align:"right"})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});export{he as default};
