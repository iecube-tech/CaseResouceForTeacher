import{h as J,d as A,u as U,b as h,m as $,ar as K,a as S,c as j,i as c,g as p,w as d,q as C,t as _,F as x,j as D,n as Q,H as M,W as X,r as Z,al as ee,am as te,an as ae,ao as ne,y as le,N as oe,O as se}from"./index-8f9ccc2f.js";/* empty css                *//* empty css                             */function re(N){return J({url:"/dlog/compare/"+N,method:"GET"})}function ie(N){return J({url:"/task/brief",method:"GET",params:{projectId:N}})}const ue={style:{"margin-top":"20px"}},ce={style:{"text-align":"center"}},pe={style:"text-align: center;"},de={style:"text-align: center;"},he=A({__name:"index",setup(N){const E=U(),O=h(E.params.projectId),g=h({projectName:"",createTime:void 0,startTime:void 0,endTime:void 0}),T=h(),u=h(),f=h(0),b=["OSC软面板","DCPower软面板","FGen软面板","DMM软面板","SMU软面板","IV测试仪软面板","CV曲线软面板","DIO软面板"],r=h([]),w=e=>X(e).format("YYYY年MM月DD日 HH:mm"),V=e=>{f.value=e,I()},P=e=>e!=f.value?"process":"finish",B=e=>{L(e.id,f.value)},L=async(e,t)=>{await Z.push({name:"ProjectStudentDetail",params:{studentId:e,projectId:O.value,stepNum:t}})},F=e=>{for(let t=0;t<e.length;t++)if(e[t].taskNum==f.value)return e[t].time;return null},Y=e=>{if(e){let t=Math.floor(e/1e3),n=Math.floor(t/3600);t%=3600;let a=Math.floor(t/60),o=t%60,i="";return n==0?i=a+"分"+o+"秒":i=n+"小时"+a+"分"+o+"秒",i}return null},G=(e,t)=>{for(let n=0;n<t.length;n++)if(t[n].taskNum==f.value&&t[n].operations){for(let a=0;a<t[n].operations.length;a++)if(e==t[n].operations[a].name)return t[n].operations[a].count}return null},H=e=>{if(e){var t=0;for(let n=0;n<e.length;n++){let a=new Date(e[n][0]),o=new Date(e[n][1]);t=t+(o.getTime()-a.getTime())}}return t},v=h([]),I=()=>{v.value=[];let e={name:"",operationCount:[]};for(let a=0;a<b.length;a++)e.name=b[a],v.value.push(JSON.parse(JSON.stringify(e)));let t=[],n={id:null,operations:null};for(let a=0;a<r.value.length;a++)for(let o=0;o<r.value[a].taskOperationsList.length;o++)r.value[a].taskOperationsList[o].taskNum==f.value&&(n.id=r.value[a].id,n.operations=r.value[a].taskOperationsList[o].operations,t.push(JSON.parse(JSON.stringify(n))));for(let a=0;a<t.length;a++)if(t[a].operations)for(let o=0;o<t[a].operations.length;o++)for(let i=0;i<v.value.length;i++)t[a].operations[o].name==v.value[i].name&&v.value[i].operationCount.push({id:t[a].id,value:t[a].operations[o].count});console.log(v.value)},R=()=>{for(let e=0;e<u.value.length;e++){let t={id:u.value[e].id,studentId:u.value[e].studentId,studentName:u.value[e].studentName,taskOperationsList:[]};for(let n=0;n<u.value[e].tasksOperations.length;n++){let a={taskNum:u.value[e].tasksOperations[n].taskNum,pstId:u.value[e].tasksOperations[n].pstId,time:H(JSON.parse(u.value[e].tasksOperations[n].times)),operations:JSON.parse(u.value[e].tasksOperations[n].operations)};t.taskOperationsList.push(JSON.parse(JSON.stringify(a)))}r.value.push(JSON.parse(JSON.stringify(t)))}I(),console.log(r)},W=e=>{var m;let t=[],n={id:null,value:null};for(let s=0;s<r.value.length;s++)for(let l=0;l<r.value[s].taskOperationsList.length;l++)r.value[s].taskOperationsList[l].taskNum==f.value&&r.value[s].taskOperationsList[l].time&&(n.id=r.value[s].id,n.value=r.value[s].taskOperationsList[l].time,t.push(JSON.parse(JSON.stringify(n))));if(t.length<2)return"";const a=(m=t.find(s=>s.id===e))==null?void 0:m.value;if(a===void 0)return"";const o=t.map(s=>s.value),i=Math.max(...o),k=Math.min(...o);return a===i?"color: red;":a===k?"color: #33b8b9;":""},q=(e,t)=>{var m,s;const n=(m=v.value.find(l=>l.name===e))==null?void 0:m.operationCount;if(!n||n.length<2)return"";const a=(s=n.find(l=>l.id===t))==null?void 0:s.value;if(a===void 0)return"";const o=n.map(l=>l.value),i=Math.max(...o),k=Math.min(...o);return a===i?"color: red;":a===k?"color: #33b8b9;":""};return $(()=>{K(O.value).then(e=>{e.state==200&&(g.value=e.data)}),ie(O.value).then(e=>{e.state==200&&(T.value=e.data,f.value=T.value[0].taskNum)}),re(O.value).then(e=>{e.state==200&&(u.value=e.data,R())})}),(e,t)=>{const n=ee,a=te,o=ae,i=ne,k=le,m=oe,s=se;return S(),j(x,null,[c("div",null,[p(a,{title:g.value.projectName},{default:d(()=>[p(n,{label:"创建时间"},{default:d(()=>[C(_(w(g.value.createTime)),1)]),_:1}),p(n,{label:"开始时间"},{default:d(()=>[C(_(w(g.value.startTime)),1)]),_:1}),p(n,{label:"结束时间"},{default:d(()=>[C(_(w(g.value.endTime)),1)]),_:1})]),_:1},8,["title"])]),p(k,{style:{"margin-top":"20px"}},{default:d(()=>[p(i,{"align-center":"",style:{width:"100%"}},{default:d(()=>[(S(!0),j(x,null,D(T.value,(l,z)=>(S(),Q(o,{title:"实验"+l.taskNum,status:P(l.taskNum),onClick:y=>V(l.taskNum)},null,8,["title","status","onClick"]))),256))]),_:1})]),_:1}),c("div",ue,[p(s,{data:r.value,stripe:"","default-sort":{prop:"studentId",order:"descending"},"header-cell-style":{fontWeight:"bold",textAlign:"center"},style:{"min-height":"800px"},onRowClick:B},{default:d(()=>[p(m,{label:"姓名/学号"},{default:d(l=>[c("div",ce,[c("span",null,_(l.row.studentName),1),t[0]||(t[0]=c("br",null,null,-1)),c("span",null,_(l.row.studentId),1)])]),_:1}),p(m,{label:"实验用时"},{default:d(l=>[c("div",pe,[c("span",{style:M(W(l.row.id))},_(Y(F(l.row.taskOperationsList))),5)])]),_:1}),(S(),j(x,null,D(b,(l,z)=>p(m,{label:l+"/次"},{default:d(y=>[c("div",de,[c("span",{style:M(q(l,y.row.id))},_(G(l,y.row.taskOperationsList)),5)])]),_:2},1032,["label"])),64))]),_:1},8,["data"])])],64)}}});export{he as default};
