import{d as le,br as ce,bs as ye,b as x,bt as fe,o as K,D as be,a as p,c as b,i as c,s as I,z as ge,_ as Ve,aV as ve,S as De,e as X,q as R,t as q,g as t,w as o,F as v,j as z,f as y,n as L,bc as j,bo as G,k as U,bq as _,a2 as we,a3 as xe,a0 as qe,$ as ke,ax as Ee,a7 as Ue,P as Re,af as Ie,x as te,a5 as Ce,a6 as Te,bl as Le,ac as Se,b3 as Ne,ad as Oe,u as $e,bk as ze,aR as Me}from"./index-8f9ccc2f.js";/* empty css                  */import{l as P}from"./lodash-56abab90.js";import"./stuLab-819536eb.js";/* empty css                *//* empty css                  */import{V as Pe}from"./index-4be9d6ee.js";/* empty css                   */import{s as ee,D as Be}from"./browser-19b77043.js";import{s as he,c as Fe,C as Ae,d as He,e as je,f as Ge,h as Je,b as We}from"./interfaces-2a72a038.js";import{n as Qe,o as Xe,h as Ke,j as Ye,p as Ze}from"./index-9020ea85.js";import{G as _e}from"./getVideo-88887dd2.js";import{_ as ea}from"./xComponet-93f6ef88.js";/* empty css                       */import"./marked.esm-fed877e7.js";import"./katex-4b21be29.js";import"./purify.es-9c590e79.js";import"./tracneline.vue_vue_type_script_setup_true_lang-e84559dc.js";const aa={class:"h-full w-full"},la=le({__name:"contentEdit",props:{modelValue:{type:String,default:""},modelModifiers:{}},emits:ce(["input","focus","blur","change"],["update:modelValue"]),setup(e,{expose:D,emit:m}){const V=m,{formItem:u}=ye(),k=x(null);let r=null;const C=fe(e,"modelValue"),S=i=>{r&&r.setValue(i||"")},M=()=>{const i=(r==null?void 0:r.getValue())||"";return C.value=i,V("input",i),V("change",i),u&&u.validate&&(console.log("formItem is available input"),u.validate("change")),i},T=P.debounce(()=>{M()},200);function N(){k.value&&(r=new Pe(k.value,{width:"100%",theme:"classic",preview:{theme:{current:"ant-design"}},cache:{enable:!1},toolbar:["headings","bold","italic","strike","link","|","list","ordered-list","check","|","quote","line","code","inline-code","insert-before","insert-after","|","upload","table","|","undo","redo"],toolbarConfig:{hide:!1},placeholder:"请在此处输入内容",upload:{accept:"image/*",url:"/dev-api/files/e/image",linkToImgUrl:"/dev-api/files/e/image",fieldName:"file",multiple:!1,success(i,s){const g=JSON.parse(s).data;r==null||r.insertValue(`![${g.title}](/dev-api/${g.url})`)},error:i=>{I.error(JSON.parse(i).message)},filename:i=>i},after:()=>{S(C.value)},blur:()=>{const i=(r==null?void 0:r.getValue())||"";C.value=i,V("blur",i),u&&u.validate&&(console.log("formItem is available"),u.validate("blur").catch(()=>{}))},input:()=>{T()}}))}return D({focus:()=>r==null?void 0:r.focus(),blur:()=>r==null?void 0:r.blur(),setValue:S,getValue:()=>r==null?void 0:r.getValue()}),K(()=>{N()}),be(()=>{r&&r.destroy()}),(i,s)=>(p(),b("div",aa,[c("div",{class:"h-full w-full",ref_key:"textEditRef",ref:k},null,512)]))}}),ta=["id","innerHTML"],oa=le({__name:"textPreview",props:{id:String,content:String},setup(e){const D=e,m=x();function V(u){return Be.sanitize(u)}return ge(()=>D.content,(u,k)=>{u&&(m.value=V(ee.parse(u)).replace(/<p[^>]*>\s*<\/p>/g,""))}),K(()=>{m.value=V(ee.parse(D.content)).replace(/<p[^>]*>\s*<\/p>/g,"")}),(u,k)=>(p(),b("div",{id:e.id,innerHTML:m.value},null,8,ta))}});const ae=Ve(oa,[["__scopeId","data-v-755c822e"]]),na=(e,D,m)=>{if(!D){m(new Error("不能为空"));return}if(D.trim()===""){m(new Error("不能为空"));return}else{m();return}},da={class:"w-full flex items-center"},ua={class:"flex flex-col"},ia={class:"flex items-center"},sa={class:"mr-2"},ma={class:"w-full flex items-center"},ra={class:"flex items-center"},pa={class:"mr-2"},ca={__name:"componentDesign",props:{bookId:String,labId:String,compData:Object,isEdit:Boolean},emits:["submit"],setup(e,{emit:D}){const m=e,V=D;ve(()=>{m.compData.totalScore?m.compData.scoreProportion=parseFloat((m.compData.score/m.compData.totalScore).toFixed(2)):m.compData.scoreProportion=0});const u=x([]);(()=>{Qe(m.bookId).then(d=>{d.state==200?u.value=d.data:I.error(d.message)})})();const r=De({name:[{required:!0,message:"请输入名称",trigger:"blur"}],"payload.question.question":[{type:"string",required:!0,message:"请输入题目问题",trigger:"blur"}],"payload.question.options":[{type:"array",required:!0,message:"请设置选项",trigger:"blur"}],"payload.question.answer":[{type:"string",required:!0,message:"请设置题目答案",trigger:"blur"}],"payload.question.answerOption":[{type:"array",required:!0,message:"请设置答案选项",trigger:"blur"}],"payload.table.col":[{type:"number",required:!0,min:2,max:10,message:"请设置列数",trigger:"blur"}],"payload.table.row":[{type:"number",required:!0,min:1,max:20,message:"请设置行数",trigger:"blur"}],"payload.table.tableName":[{type:"string",required:!0,message:"请输入表名",trigger:"blur"}],"payload.question.min":[{type:"number",required:!0,message:"请设置值",trigger:"blur"}],"payload.question.max":[{type:"number",required:!0,message:"请设置值",trigger:"blur"}]}),C=x({"x-access-token":localStorage.getItem("x-access-token"),"x-access-type":localStorage.getItem("x-access-type")}),S=d=>{m.compData.payload.video.filename=d.data.filename,m.compData.payload.video.isReady=d.data.isReady,setTimeout(()=>{M(d.data.filename)},1e3)},M=d=>{d&&d!=""&&_e(d).then(a=>{a.state==200?m.compData.payload.video.isReady=a.data.isReady:I.warning(a.message)})},T=d=>d.type!=="video/mp4"?(I.error("请确认视频格式为 MP4"),!1):d.size/1024/1024>200?(I.error("请确认视频小于200MB!"),!1):!0,N=x(null),i=()=>{m.compData.payload.video.filename="",m.compData.payload.video.isReady=0,N.value.clearFiles()},s=x(""),g=()=>{let d={label:Ae[m.compData.payload.question.options.length],value:s.value};m.compData.payload.question.options.push(d),s.value=""},B=x(null),J=()=>{B.value.validate(d=>{d&&w(P.cloneDeep(m.compData))})},w=d=>{m.isEdit?F(d):h(d)},h=d=>{if(["TABLE","TRACELINE"].includes(d.type)){for(let a=0;a<d.payload.table.col;a++){let E=P.cloneDeep(He());d.payload.table.tableHeader.push(E)}for(let a=0;a<d.payload.table.row;a++){d.payload.table.tableRow.push([]);for(let E=0;E<d.payload.table.col;E++){let O=P.cloneDeep(je());d.payload.table.tableRow[a].push(O)}}}d.payload=JSON.stringify(d.payload),Xe(m.labId,d).then(a=>{a.state==200?V("submit"):I.error(a.message)})},F=d=>{d.payload=JSON.stringify(d.payload),Ke(m.labId,d).then(a=>{a.state==200?V("submit"):I.error(a.message)})},oe=x(["QA","MULTIPLECHOICE","CHOICE","TABLE","TRACELINE"]);return(d,a)=>{const E=we,O=xe,n=qe,f=ke,W=Ee,$=Ue,ne=X("UploadFilled"),Y=Re,de=Ie,ue=X("Delete"),Q=te,ie=Ce,se=Te,A=Le,me=Se,re=Ne,pe=Oe;return p(),b("div",null,[R(q(e.compData.type)+" ",1),t(pe,{model:e.compData,rules:y(r),ref_key:"compFormRef",ref:B,"label-width":"100"},{default:o(()=>[t(n,{label:"实验步骤",prop:"stage",placeholder:"请选择实验步骤"},{default:o(()=>[t(O,{modelValue:e.compData.stage,"onUpdate:modelValue":a[0]||(a[0]=l=>e.compData.stage=l)},{default:o(()=>[(p(!0),b(v,null,z(y(he),(l,H)=>(p(),L(E,{key:H,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"类型",prop:"type"},{default:o(()=>[t(O,{modelValue:e.compData.type,"onUpdate:modelValue":a[1]||(a[1]=l=>e.compData.type=l),placeholder:"选择类型"},{default:o(()=>[(p(!0),b(v,null,z(y(Fe),(l,H)=>(p(),L(E,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"名称",prop:"name"},{default:o(()=>[t(f,{modelValue:e.compData.name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.compData.name=l)},null,8,["modelValue"])]),_:1}),t(n,{label:"监测点",prop:"tag"},{default:o(()=>[t(O,{modelValue:e.compData.tag,"onUpdate:modelValue":a[3]||(a[3]=l=>e.compData.tag=l),clearable:""},{default:o(()=>[(p(!0),b(v,null,z(y(u),(l,H)=>(p(),L(E,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),j(t(n,{label:"是否计算分值",prop:"needCalculate"},{default:o(()=>[t(W,{modelValue:e.compData.needCalculate,"onUpdate:modelValue":a[4]||(a[4]=l=>e.compData.needCalculate=l)},null,8,["modelValue"])]),_:1},512),[[G,y(oe).includes(e.compData.type)]]),j(t(n,{label:"题目分数",prop:"totalScore"},{default:o(()=>[t($,{modelValue:e.compData.totalScore,"onUpdate:modelValue":a[5]||(a[5]=l=>e.compData.totalScore=l),min:0},null,8,["modelValue"])]),_:1},512),[[G,e.compData.needCalculate]]),m.compData.type=="TEXT"?(p(),L(n,{key:0,label:"内容",prop:"payload.content",rules:[{required:!0,validator:y(na),message:"请输入内容",trigger:["blur","change"]}]},{default:o(()=>[t(la,{modelValue:e.compData.payload.content,"onUpdate:modelValue":a[6]||(a[6]=l=>e.compData.payload.content=l)},null,8,["modelValue"])]),_:1},8,["rules"])):U("",!0),e.compData.type=="VIDEO"?(p(),b(v,{key:1},[t(n,{label:"视频",prop:"payload.video.filename",rules:[{required:!0,validator:(l,H,Z)=>{e.compData.payload.video.filename==""?Z(new Error("请上传视频")):Z()},trigger:"change"}]},{default:o(()=>[t(de,{ref_key:"uploadRef",ref:N,class:"upload-demo",drag:"",action:"/dev-api/video/n/up",headers:y(C),"on-success":S,"show-file-list":!1,"before-upload":T},{default:o(()=>[t(Y,{class:"el-icon--upload"},{default:o(()=>[t(ne)]),_:1}),a[38]||(a[38]=c("div",{class:"el-upload__text"},[R(" 将视频拖入 或 "),c("em",null,"点击上传")],-1))]),_:1,__:[38]},8,["headers"]),c("div",null,[c("span",null,q(e.compData.payload.video.filename),1),j(t(Y,{class:"ml-4",onClick:i},{default:o(()=>[t(ue)]),_:1},512),[[G,e.compData.payload.video.filename]])])]),_:1},8,["rules"]),t(n,{label:"视频标题",prop:"payload.video.title",rules:[{required:!0,message:"请输入视频标题",trigger:"blur"}]},{default:o(()=>[t(f,{modelValue:e.compData.payload.video.title,"onUpdate:modelValue":a[7]||(a[7]=l=>e.compData.payload.video.title=l)},null,8,["modelValue"])]),_:1}),t(n,{label:"视频描述",prop:"payload.video.description",rules:[{required:!0,message:"请输入视频描述",trigger:"blur"}]},{default:o(()=>[t(f,{modelValue:e.compData.payload.video.description,"onUpdate:modelValue":a[8]||(a[8]=l=>e.compData.payload.video.description=l)},null,8,["modelValue"])]),_:1}),t(n,{label:"视频时长",prop:"palyload.video.duration"},{default:o(()=>[t(f,{modelValue:e.compData.payload.video.duration,"onUpdate:modelValue":a[9]||(a[9]=l=>e.compData.payload.video.duration=l),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})],64)):U("",!0),e.compData.type==="GROUP"?(p(),b(v,{key:2},[t(n,{label:"限制人数",prop:"group.limitNum"},{default:o(()=>[t($,{modelValue:e.compData.payload.group.limitNum,"onUpdate:modelValue":a[10]||(a[10]=l=>e.compData.payload.group.limitNum=l),min:"1"},null,8,["modelValue"])]),_:1}),t(n,{label:"显示",prop:"group.showByDevice"},{default:o(()=>[t(W,{modelValue:e.compData.payload.group.showByDevice,"onUpdate:modelValue":a[11]||(a[11]=l=>e.compData.payload.group.showByDevice=l),"active-text":"根据设备状态显示","inactive-text":"永久显示"},null,8,["modelValue"])]),_:1}),t(n,{label:"提示信息",prop:"group.message"},{default:o(()=>[t(f,{modelValue:e.compData.payload.group.message,"onUpdate:modelValue":a[12]||(a[12]=l=>e.compData.payload.group.message=l)},null,8,["modelValue"])]),_:1})],64)):U("",!0),e.compData.type==="DEVICE"?(p(),L(n,{key:3,label:"设备类型",prop:"device.deviceType"},{default:o(()=>[t(O,{modelValue:e.compData.payload.device.deviceType,"onUpdate:modelValue":a[13]||(a[13]=l=>e.compData.payload.device.deviceType=l)},{default:o(()=>[t(E,{label:"3835",value:"3835"}),t(E,{label:"2830",value:"2830"})]),_:1},8,["modelValue"])]),_:1})):U("",!0),e.compData.type=="CHOICE"?(p(),b(v,{key:4},[t(n,{label:"题目：",prop:"payload.question.question"},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.question,"onUpdate:modelValue":a[14]||(a[14]=l=>e.compData.payload.question.question=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目支持markdown，不要输入题目编号"},null,8,["modelValue"])]),_:1}),t(n,{label:"选项：",prop:"payload.question.options"},{default:o(()=>[c("div",da,[t(f,{class:"mr-2",modelValue:y(s),"onUpdate:modelValue":a[15]||(a[15]=l=>_(s)?s.value=l:null)},null,8,["modelValue"]),t(Q,{type:"primary",size:"small",onClick:g},{default:o(()=>a[39]||(a[39]=[R("添加",-1)])),_:1,__:[39]})]),c("div",ua,[t(se,{modelValue:e.compData.payload.question.answer,"onUpdate:modelValue":a[16]||(a[16]=l=>e.compData.payload.question.answer=l)},{default:o(()=>[(p(!0),b(v,null,z(e.compData.payload.question.options,l=>(p(),L(ie,{label:l.label},{default:o(()=>[c("div",ia,[c("span",sa,q(l.label)+".",1),t(ae,{content:l.value},null,8,["content"])])]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])])]),_:1}),t(n,{label:"答案：",prop:"payload.question.answer"},{default:o(()=>[R(q(e.compData.payload.question.answer),1)]),_:1}),t(n,{label:"解析："},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.analysis,"onUpdate:modelValue":a[17]||(a[17]=l=>e.compData.payload.question.analysis=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目解析 支持markdown"},null,8,["modelValue"])]),_:1}),t(n,{label:"难度：",prop:"payload.question.difficulty"},{default:o(()=>[t(A,{modelValue:e.compData.payload.question.difficulty,"onUpdate:modelValue":a[18]||(a[18]=l=>e.compData.payload.question.difficulty=l),min:1,max:10},null,8,["modelValue"])]),_:1})],64)):U("",!0),e.compData.type=="MULTIPLECHOICE"?(p(),b(v,{key:5},[t(n,{label:"题目：",prop:"payload.question.question"},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.question,"onUpdate:modelValue":a[19]||(a[19]=l=>e.compData.payload.question.question=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目支持markdown，不要输入题目编号"},null,8,["modelValue"])]),_:1}),t(n,{label:"选项：",prop:"payload.question.options"},{default:o(()=>[c("div",ma,[t(f,{class:"mr-2",modelValue:y(s),"onUpdate:modelValue":a[20]||(a[20]=l=>_(s)?s.value=l:null)},null,8,["modelValue"]),t(Q,{type:"primary",size:"small",onClick:g},{default:o(()=>a[40]||(a[40]=[R("添加",-1)])),_:1,__:[40]})]),t(re,{modelValue:e.compData.payload.question.answerOption,"onUpdate:modelValue":a[21]||(a[21]=l=>e.compData.payload.question.answerOption=l)},{default:o(()=>[(p(!0),b(v,null,z(e.compData.payload.question.options,l=>(p(),L(me,{label:l.label},{default:o(()=>[c("div",ra,[c("span",pa,q(l.label)+".",1),t(ae,{content:l.value},null,8,["content"])])]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"答案：",prop:"payload.question.answerOption"},{default:o(()=>[R(q(e.compData.payload.question.answerOption),1)]),_:1}),t(n,{label:"解析：",prop:"analysis"},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.analysis,"onUpdate:modelValue":a[22]||(a[22]=l=>e.compData.payload.question.analysis=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目解析 支持markdown"},null,8,["modelValue"])]),_:1}),t(n,{label:"难度：",prop:"difficulty"},{default:o(()=>[t(A,{modelValue:e.compData.payload.question.difficulty,"onUpdate:modelValue":a[23]||(a[23]=l=>e.compData.payload.question.difficulty=l),max:10},null,8,["modelValue"])]),_:1})],64)):U("",!0),["QA","CIRCUIT"].includes(e.compData.type)?(p(),b(v,{key:6},[t(n,{label:"题目：",prop:"payload.question.question"},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.question,"onUpdate:modelValue":a[24]||(a[24]=l=>e.compData.payload.question.question=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目 支持markdown，不要输入题目编号"},null,8,["modelValue"])]),_:1}),t(n,{label:"答案：",prop:"payload.question.answer"},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.answer,"onUpdate:modelValue":a[25]||(a[25]=l=>e.compData.payload.question.answer=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目答案 支持markdown"},null,8,["modelValue"])]),_:1}),t(n,{label:"解析：",prop:"payload.question.analysis"},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.analysis,"onUpdate:modelValue":a[26]||(a[26]=l=>e.compData.payload.question.analysis=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目解析 支持markdown"},null,8,["modelValue"])]),_:1}),t(n,{label:"错误引导："},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.hintWhenWrong,"onUpdate:modelValue":a[27]||(a[27]=l=>e.compData.payload.question.hintWhenWrong=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目错误指引 支持markdown"},null,8,["modelValue"])]),_:1}),t(n,{label:"难度：",prop:"difficulty"},{default:o(()=>[t(A,{modelValue:e.compData.payload.question.difficulty,"onUpdate:modelValue":a[28]||(a[28]=l=>e.compData.payload.question.difficulty=l),max:10},null,8,["modelValue"])]),_:1})],64)):U("",!0),["TABLE","TRACELINE"].includes(e.compData.type)?(p(),b(v,{key:7},[t(n,{label:"表名：",prop:"payload.table.tableName",rules:[{type:"string",required:!0,message:"请输入表名",trigger:"blur"}]},{default:o(()=>[t(f,{modelValue:e.compData.payload.table.tableName,"onUpdate:modelValue":a[29]||(a[29]=l=>e.compData.payload.table.tableName=l)},null,8,["modelValue"])]),_:1}),t(n,{label:"列数：",prop:"payload.table.col",rules:[{type:"number",required:!0,min:2,max:10,message:"请输入列数",trigger:"blur"}]},{default:o(()=>[t($,{modelValue:e.compData.payload.table.col,"onUpdate:modelValue":a[30]||(a[30]=l=>e.compData.payload.table.col=l),min:2,max:10,disabled:e.isEdit},null,8,["modelValue","disabled"])]),_:1}),t(n,{label:"行数：",prop:"payload.table.row",rules:[{type:"number",required:!0,min:1,max:20,message:"请输入行数",trigger:"blur"}]},{default:o(()=>[t($,{modelValue:e.compData.payload.table.row,"onUpdate:modelValue":a[31]||(a[31]=l=>e.compData.payload.table.row=l),min:1,max:20,disabled:e.isEdit},null,8,["modelValue","disabled"])]),_:1}),j(t(n,{label:"对数坐标系",prop:"payload.tracneline.coordinateIsLog"},{default:o(()=>[t(W,{modelValue:e.compData.payload.tracneline.coordinateIsLog,"onUpdate:modelValue":a[32]||(a[32]=l=>e.compData.payload.tracneline.coordinateIsLog=l)},null,8,["modelValue"])]),_:1},512),[[G,e.compData.type=="TRACELINE"]])],64)):U("",!0),e.compData.type=="RANGE"?(p(),b(v,{key:8},[t(n,{label:"题目：",prop:"payload.question.question"},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.question,"onUpdate:modelValue":a[33]||(a[33]=l=>e.compData.payload.question.question=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目支持markdown，不要输入题目编号"},null,8,["modelValue"])]),_:1}),t(n,{label:"最小值：",prop:"payload.question.min"},{default:o(()=>[t($,{modelValue:e.compData.payload.question.min,"onUpdate:modelValue":a[34]||(a[34]=l=>e.compData.payload.question.min=l),max:e.compData.payload.question.max},null,8,["modelValue","max"])]),_:1}),t(n,{label:"最大值：",prop:"payload.question.max"},{default:o(()=>[t($,{modelValue:e.compData.payload.question.max,"onUpdate:modelValue":a[35]||(a[35]=l=>e.compData.payload.question.max=l),min:e.compData.payload.question.min},null,8,["modelValue","min"])]),_:1}),t(n,{label:"解析：",prop:"payload.question.analysis"},{default:o(()=>[t(f,{modelValue:e.compData.payload.question.analysis,"onUpdate:modelValue":a[36]||(a[36]=l=>e.compData.payload.question.analysis=l),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"输入题目解析 支持markdown"},null,8,["modelValue"])]),_:1}),t(n,{label:"难度：",prop:"payload.question.difficulty"},{default:o(()=>[t(A,{modelValue:e.compData.payload.question.difficulty,"onUpdate:modelValue":a[37]||(a[37]=l=>e.compData.payload.question.difficulty=l),max:10},null,8,["modelValue"])]),_:1})],64)):U("",!0),t(n,null,{default:o(()=>[t(Q,{type:"primary",onClick:J},{default:o(()=>a[41]||(a[41]=[R(" 确定 ",-1)])),_:1,__:[41]})]),_:1})]),_:1},8,["model","rules"])])}}},ya={class:"bg-gray-50 min-h-screen"},fa={class:"bg-white border-b border-l border-gray-200 sticky top-0 z-50"},ba={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ga={class:"flex justify-between items-center h-16"},Va={class:"flex items-center space-x-2"},va={class:"w-full h-full min-h-screen p-6 border-l"},Da={class:"flex flex-row justify-between p-4 bg-gray-100 border border-gray-300"},wa={class:"p-8"},xa={class:"text-3xl"},Fa={__name:"labComponentManage",setup(e){const D=$e(),m=x(D.params.bookId),V=x(D.params.labId),u=x({visible:!1,isEdit:!1,title:"添加组件",compData:null}),k=x([]),r=i=>{let s=i!==void 0;if(u.value.title=s?"编辑组件":"添加组件",u.value.isEdit=s,!u.value.isEdit)u.value.compData=Ge();else{let g=P.cloneDeep(i);g.payload=JSON.parse(g.payload),g.payload.hasOwnProperty("statics")||(g.payload.statics=Je()),u.value.compData=g}u.value.visible=!0},C=()=>{u.value.visible=!1,u.value.isEdit=!1,u.value.title="",u.value.compData=null},S=()=>{T(),C()},M=i=>{Me.confirm(`确定要删除该组件【${i.name}】吗？`,"提示",{type:"warning"}).then(async()=>{Ze(V.value,i.id).then(s=>{s.state==200?(T(),I.success("删除成功")):I.error(s.message)})})},T=()=>{Ye(V.value).then(i=>{if(i.state==200){let s=i.data||[];s.forEach(g=>{N(g)}),k.value=s}else I.error(i.message)})},N=i=>{i.id=i.componentId};return K(()=>{T()}),(i,s)=>{const g=te,B=X("font-awesome-icon"),J=ze;return p(),b("div",ya,[c("header",fa,[c("div",ba,[c("div",ga,[c("div",Va,[t(g,{type:"primary",onClick:s[0]||(s[0]=w=>r())},{default:o(()=>s[2]||(s[2]=[R("添加组件",-1)])),_:1,__:[2]})]),c("div",null,[c("span",null," 实验模板组件管理 - 实验id: "+q(y(V)),1)])])])]),c("div",va,[(p(!0),b(v,null,z(y(k),(w,h)=>(p(),b("div",{key:h,class:"mb-4 border border-gray-200 bg-white"},[c("div",Da,[c("div",null,q(w.name)+" -- "+q(w.type)+" -- "+q(y(We)(w.stage)),1),c("div",null,[t(g,{size:"small",onClick:F=>r(w)},{default:o(()=>s[3]||(s[3]=[R("编辑",-1)])),_:2,__:[3]},1032,["onClick"]),t(g,{size:"small",type:"danger",onClick:F=>M(w)},{default:o(()=>s[4]||(s[4]=[R("删除",-1)])),_:2,__:[4]},1032,["onClick"])])]),c("div",wa,[t(ea,{labId:y(V),item:w,compTemplateList:y(k),class:"ist-theam",onUpdateCompData:T},null,8,["labId","item","compTemplateList"])])]))),128))]),t(J,{modelValue:y(u).visible,"onUpdate:modelValue":s[1]||(s[1]=w=>y(u).visible=w),"show-close":!1,"append-to-body":"",size:"60%"},{header:o(({close:w,titleId:h,titleClass:F})=>[c("div",xa,q(y(u).title),1),c("button",{onClick:C},[t(B,{icon:"fa-solid fa-xmark"})])]),default:o(()=>[y(u).compData?(p(),L(ca,{key:0,compData:y(u).compData,isEdit:y(u).isEdit,bookId:y(m),labId:y(V),onSubmit:S},null,8,["compData","isEdit","bookId","labId"])):U("",!0)]),_:1},8,["modelValue"])])}}};export{Fa as default};
