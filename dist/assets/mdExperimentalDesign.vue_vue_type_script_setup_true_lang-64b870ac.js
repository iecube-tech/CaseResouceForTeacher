import{h as $,d as j,m as H,b as d,s as p,S as z,a as v,c as w,g as s,w as o,F as L,j as R,n as V,q as f,a7 as A,a0 as G,a2 as J,a3 as K,$ as Q,x as W,ad as X}from"./index-8f9ccc2f.js";import{a as Y,u as Z}from"./updateTaskTemplate-f6a23dc4.js";import{a as h}from"./index-9020ea85.js";function te(b,_){return $({url:"/emd_content/up_completion",method:"POST",params:{id:b,completion:_}})}const se=j({__name:"mdExperimentalDesign",props:{course:Object,isEdit:Boolean,oldTaskTemplate:Object,lastTaskNum:Number},emits:["addSuccess","exitUpdate"],setup(b,{emit:_}){const m=b;H(()=>{E.value=m.course.id,c.value=m.course,x.value=m.lastTaskNum,l.value.taskDevice=c.value.deviceId,l.value.num=x.value+1,I(),m.isEdit&&(l.value=m.oldTaskTemplate)});const E=d(0),c=d(),x=d(0),T=d(),l=d({id:null,contentId:E.value,num:null,taskName:"",taskCover:"",taskDevice:null,taskDetails:null,taskEMdProc:null,classHour:null,weighting:null});d("");const i=d([]),I=()=>{h(c.value.emdv4Course).then(a=>{a.state==200?i.value=a.data:p.error(a.message)})},M=()=>{for(let a=0;a<i.value.length;a++)if(i.value[a].id==l.value.taskEMdProc){l.value.taskName=i.value[a].name;return}},U=z({taskName:[{required:!0,message:"请输入实验名称",trigger:"blur"}],num:[{required:!0,message:"请输入实验序号",trigger:"blur"}],taskEMdProc:[{required:!0,message:"请选择实验指导书",trigger:"blur"}],weighting:[{required:!0,message:"请设置实验权重",trigger:"blur"}],classHour:[{required:!0,message:"请设置实验课时",trigger:"blur"}]}),y=_,C=a=>{y("addSuccess",a)},N=()=>{y("exitUpdate")},F=async a=>{a&&await a.validate((e,r)=>{if(e){l.value.contentId=E.value,l.value.taskDevice=c.value.deviceId,console.log(l.value);let u=Object.assign({},l.value);Y(u).then(n=>{n.state==200?(k(),C(n.data),p.success("添加成功")):p.error(n.message)})}else console.log("error submit!",r)})},P=async a=>{a&&await a.validate((e,r)=>{if(e){let u=Object.assign({},l.value);Z(u).then(n=>{n.state==200?(k(),C(n.data),N(),p.success("更新成功")):p.error(n.message)})}else console.log("error submit!",r)})},B=()=>{k(),N()},k=()=>{l.value.taskName="",l.value.num=null,l.value.taskCover="",l.value.taskDetails=null,l.value.taskEMdProc=null};return(a,e)=>{const r=A,u=G,n=J,S=K,q=Q,g=W,D=X;return v(),w("div",null,[s(D,{"label-width":"150px",ref_key:"addTaskFormRef",ref:T,model:l.value,rules:U},{default:o(()=>[s(u,{label:"实验序号：",prop:"num"},{default:o(()=>[s(r,{min:1,max:25,modelValue:l.value.num,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.num=t)},null,8,["modelValue"])]),_:1}),s(u,{label:"实验指导书：",prop:"taskEMdProc"},{default:o(()=>[s(S,{modelValue:l.value.taskEMdProc,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.taskEMdProc=t),placeholder:"选择指导书",style:{width:"420px"},onChange:e[2]||(e[2]=t=>M())},{default:o(()=>[(v(!0),w(L,null,R(i.value,(t,O)=>(v(),V(n,{key:O,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(u,{label:"实验名称：",prop:"taskName"},{default:o(()=>[s(q,{style:{width:"420px"},modelValue:l.value.taskName,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.taskName=t)},null,8,["modelValue"])]),_:1}),s(u,{label:"实验权重(%)：",prop:"weighting"},{default:o(()=>[s(r,{min:0,max:100,modelValue:l.value.weighting,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.weighting=t)},null,8,["modelValue"])]),_:1}),s(u,{label:"实验课时：",prop:"classHour"},{default:o(()=>[s(r,{modelValue:l.value.classHour,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.classHour=t)},null,8,["modelValue"])]),_:1}),m.isEdit?(v(),V(u,{key:1,style:{"margin-top":"50px"}},{default:o(()=>[s(g,{type:"primary",size:"small",onClick:e[8]||(e[8]=t=>P(T.value))},{default:o(()=>e[12]||(e[12]=[f("完成",-1)])),_:1,__:[12]}),s(g,{size:"small",onClick:e[9]||(e[9]=t=>B())},{default:o(()=>e[13]||(e[13]=[f("取消",-1)])),_:1,__:[13]})]),_:1})):(v(),V(u,{key:0,style:{"margin-top":"50px"}},{default:o(()=>[s(g,{type:"primary",size:"small",onClick:e[6]||(e[6]=t=>F(T.value))},{default:o(()=>e[10]||(e[10]=[f("添加实验",-1)])),_:1,__:[10]}),s(g,{size:"small",onClick:e[7]||(e[7]=t=>k())},{default:o(()=>e[11]||(e[11]=[f("清除内容",-1)])),_:1,__:[11]})]),_:1}))]),_:1},8,["model","rules"])])}}});export{te as U,se as _};
